import{d as k,r as f,w as h,m as S,x as q,j as m,p as b,A as C,B as U,bf as Q,U as x}from"./index.4f390c6a.js";import{Q as j}from"./QSelect.8ad877e3.js";import{U as V}from"./cloudDB.d318324a.js";import{c as F}from"./constant.a3c7e21e.js";import{u as I}from"./SearchKey.a606d0cd.js";import{a as N,m as D}from"./index.d9f23821.js";import{o as E}from"./index.4024674e.js";const L={class:"row q-mx-none q-px-none",style:{"border-radius":"8px",padding:"2px 0"}},H=k({__name:"CollectionSelect",props:{collection:{default:"pcf-fountains"},enable_search:{type:Boolean,default:!0},fountain_id:{},program_id:{}},emits:["selected"],setup($,{emit:y}){const B=I(),t=$;let r=[];const l=f([]),d=f(""),o=f("lyrics"),g=f(""),w=y,O=V.getInstance();return h(()=>[B.key,t.fountain_id,t.program_id],async([e,a,n])=>{var p;if(console.log("watch collection searchBar.key:",e),t.enable_search)try{if(e){let s="",v;switch(t.collection){case"pcf-media":s=`indexOfBytes(name, "${e}") >= 0 || indexOfBytes(alias, "${e.toUpperCase()}") >= 0 || indexOfBytes(producer, "${e}") >= 0`;break;case"uni-id-users":s=`indexOfBytes(username, "${e}") >= 0 || indexOfBytes(nickname, "${e}") >= 0`,v="_id, username, nickname, status, role, gender, email, mobile, created_at, updated_at";break;case"pcf-fountains":s=`indexOfBytes(name, "${e}") >= 0 || indexOfBytes(alias, "${e.toUpperCase()}") >= 0`;break;case"pcf-shows":a&&(s=`fountain_id == "${a}" && indexOfBytes(name, "${e}") >= 0`);break;case"pcf-scripts":n&&(s=`program_id == "${n}" && indexOfBytes(name, "${e}") >= 0`);break;case"pcf-programs":case"pcf-ma2-groups":a&&(s=`fountain_id == "${a}" && indexOfBytes(name, "${e}") >= 0`);break;default:s='_id == ""';break}const c=await O.request("getDetails/getField",{query:{collection:t.collection,condition:JSON.stringify({outWhere:s,outField:v})}});if(console.log("collection res:",c),c!=null&&c.length){r=c,l.value=[];for(const i of r){let u="";t.collection=="pcf-media"?u=`${i.name} _ ${i.producer} _ [ ${i.category} ]`:t.collection=="uni-id-users"?u=`${i.nickname} _ ${i.username}`:t.collection=="pcf-fountains"?u=`${i.name} _ ${i.alias}`:u=i.name,l.value.push(u)}let _=0;d.value=l.value[_],g.value=r[_].category||""}else!c.success&&((p=c.error)==null?void 0:p.message)&&(/resource exhausted/.test(c.error.message)?console.warn("DB resource exhausted."):console.warn("watch collection Error:",c.error.message)),r=[],l.value=[],d.value="",g.value=""}}catch(s){console.error("cloudObj collection:",s)}},{immediate:!0}),h(()=>g.value,e=>{if(e){const a=F.find(n=>n.name===e);o.value=a&&a.icon!==o.value?a.icon:"lyrics"}else switch(t.collection){case"uni-id-users":o.value="person";break;case"pcf-fountains":o.value=D;break;case"pcf-shows":o.value="movie";break;case"pcf-programs":o.value="description";break;case"pcf-scripts":o.value=N;break;case"pcf-ma2-groups":o.value=E;break;default:o.value="";break}},{immediate:!0}),h(()=>d.value,e=>{console.log("watch name:",e);let a;if((e==null?void 0:e.length)&&l.value.length){const n=l.value.findIndex(p=>p===e);n>=0&&(a=r[n])}w("selected",a)}),(e,a)=>(S(),q("div",L,[m(C,{class:"col-12 q-mx-none q-pa-none"},{default:b(()=>[m(U,{class:"items-center"},{default:b(()=>[m(j,{class:"full-width",outlined:"",modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=n=>d.value=n),options:l.value,dense:!0,"options-dense":!0,"hide-dropdown-icon":"",label:e.collection.split("-").pop(),"stack-label":""},Q({append:b(()=>[m(x,{name:o.value,color:e.enable_search?"positive":""},null,8,["name","color"])]),_:2},[e.collection=="pcf-media"?{name:"prepend",fn:b(()=>[m(x,{name:"movie",color:e.enable_search?"positive":""},null,8,["color"])]),key:"0"}:void 0]),1032,["modelValue","options","label"])]),_:1})]),_:1})]))}});export{H as _};
