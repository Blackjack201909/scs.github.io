import{d as E,r as m,w as G,m as _,n as V,p as x,j as t,aT as S,x as N,z as I,aO as L,s as g,H as v,F as O,Q as D}from"./index.4f390c6a.js";import{Q as T}from"./QForm.c09e6959.js";import{Q as Y}from"./QPage.e32daf6c.js";import{u as H}from"./use-quasar.4e14d354.js";import{u as K}from"./SearchKey.a606d0cd.js";import{_ as W}from"./CollectionSelect.2d35001e.js";import{_ as C}from"./GroupSelect.989d4c58.js";import{U as X}from"./cloudDB.d318324a.js";import{_ as Z}from"./UpdatedDate.47641b74.js";import"./QSelect.8ad877e3.js";import"./QChip.17ac3977.js";import"./QItemLabel.95b24a48.js";import"./QMenu.75c03351.js";import"./selection.1482bdb7.js";import"./rtl.0738a96b.js";import"./format.6396bb17.js";import"./constant.a3c7e21e.js";import"./index.d9f23821.js";import"./index.4024674e.js";import"./axios.ea5872bc.js";import"./date.865a2574.js";const ee={class:"row col justify-between"},le={class:"row col justify-between"},oe={class:"row col justify-between"},ae={class:"q-my-lg row justify-between"},Ve=E({__name:"ChannelEditor",setup(te){const k=H(),p=K(),i=m("Submit"),$=m(null),c=m(),r=m(),y=m(),b=m(),q={name:"",members_qty:1,universe:1,break:1,device_id:0,addr:"",mode:1},l=m({...q}),h=X.getInstance();G(()=>$.value,async o=>{if(console.log("watch docFile:",o),o){const a=await o.arrayBuffer(),n=new TextDecoder("utf-8").decode(new Uint8Array(a)),{docs:u}=JSON.parse(n);u.length&&(i.value="Submit",await z(u))}});function P(){p.getShow||p.toggleShow()}function j(){p.getShow||p.toggleShow()}function d(){p.getShow&&p.toggleShow()}async function z(o){if(console.log("updateDocs2Cloud docs:",o),o!=null&&o.length){let a="positive",e=" Added Successfully.";try{const n=await h.request("databaseCRUD/update",{query:{collection:"pcf-ma2-exec-channels",condition:JSON.stringify({fountain_id:r.value})},body:JSON.stringify(o)});console.log("updateGroupDocs res:",n),n.inserted>0&&n.ids?e=`${n.inserted} MA2 Group Data`+e:(a="negative",e="No Doc Updated."),f(a,e)}catch(n){e=typeof n=="string"?n:JSON.stringify(n),f("negative",e)}}}function f(o,a){k.notify({type:o,message:a,icon:"cloud_done",position:"top",timeout:5e3})}async function U(){console.log("onSubmit entry!"),k.notify({type:"positive",position:"center",timeout:0,icon:"cloud_done",message:`${i.value} Switch Command: ${l.value.name} ?`,actions:[{label:"Cancel",color:"white",handler:()=>{}},{label:"Yes",color:"yellow",handler:async()=>{if(console.log("onSubmit formData:",l.value),l.value&&c.value){let o="positive",a=" Successfully.";const e=l.value._id!=="newDoc"?{_id:l.value._id}:{exec_id:b.value,name:l.value.name},n=Date.now(),u={...l.value,_id:void 0,updated_at:n};let w;for(w in u)typeof u[w]=="string"&&u[w]===""&&(u[w]=void 0);u.created_at||(u.created_at=n),console.log("onSubmit body:",u);try{const s=await h.request("databaseCRUD/update",{query:{collection:"pcf-ma2-exec-channels",condition:JSON.stringify(e)},body:u});console.log("onSubmit doc res:",s),s.affectedDocs>0||s.id?(l.value.created_at||(l.value.created_at=u.created_at),l.value.updated_at=u.updated_at,i.value==="Submit"?(s.id&&(l.value._id=s.id,a=`Doc: ${s.id} Added`+a),i.value="Update"):i.value==="Update"&&(a=`${s.affectedDocs} Doc Updated`+a),c.value={...l.value}):(o="negative",a="No Doc Updated."),f(o,a)}catch(s){a=typeof s=="string"?s:JSON.stringify(s),f("negative",a)}}}}]})}function J(){console.log("onReset entry!"),l.value={...l.value,...q}}function F(){l.value={...q},l.value._id="newDoc",l.value.exec_id=b.value,c.value=l.value,i.value="Submit"}function Q(){k.notify({message:`Delete Switch Command: ${l.value.name} ?`,color:"negative",position:"center",icon:"cloud_done",timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>{}},{label:"Yes",color:"yellow",handler:async()=>{if(l.value._id!=="newDoc"&&c.value){let o="positive",a=" Successfully.";try{const e=await h.request("databaseCRUD/delete",{query:{collection:"pcf-ma2-exec-channels",condition:JSON.stringify({_id:l.value._id})}});console.log("onDelete doc res:",e),(e==null?void 0:e.deleted)===1?(c.value.name="***deleted doc***",o="warning",a=`${e.affectedDocs} Doc Deleted`+a):(o="negative",a="No Doc Deleted."),f(o,a)}catch(e){a=typeof e=="string"?e:JSON.stringify(e),f("negative",a)}}}}]})}function B(o){console.log("onExecPick doc:",o),o&&o._id!==b.value&&(b.value=o._id)}function M(o){console.log("onGroupPick doc:",o),o&&o._id!==y.value&&(y.value=o._id)}function R(o){console.log("onFountainPick data:",o),o&&o._id!==r.value&&(r.value=o._id)}async function A(o){console.log("onDocumentPick doc:",o),o?(l.value={...o},o._id==="newDoc"?(c.value=l.value,i.value="Submit"):(c.value={...o},i.value="Update")):F()}return(o,a)=>(_(),V(Y,{padding:"",class:"q-mx-sm"},{default:x(()=>[t(W,{class:"q-mt-md",onSelected:R,onClick:P}),r.value?(_(),V(C,{key:0,class:"q-mt-sm",collection:"pcf-ma2-groups",id:r.value,onSelected:M,onClick:d},null,8,["id"])):S("",!0),r.value&&y.value?(_(),V(C,{key:1,class:"q-mt-md",collection:"pcf-ma2-execs",id:y.value,onSelected:B,onClick:d},null,8,["id"])):S("",!0),r.value&&y.value&&b.value?(_(),N(O,{key:2},[t(C,{class:"q-mt-md",collection:"pcf-ma2-exec-channels",doc:c.value,onSelected:A,onClick:j},null,8,["doc"]),I(g("div",null,[t(Z,{class:"q-my-md",created_at:l.value.created_at,updated_at:l.value.updated_at},null,8,["created_at","updated_at"])],512),[[L,l.value.created_at&&l.value.updated_at]]),t(T,{class:"q-mt-lg",autofocus:"",onSubmit:U,onReset:J},{default:x(()=>[g("div",ee,[t(v,{class:"col-6 q-pr-sm",modelValue:l.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value.name=e),label:"name",outlined:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>e&&e.length>0||"name length > 0"],onFocus:d},null,8,["modelValue","rules"]),t(v,{class:"col-6 q-pl-sm",outlined:"",modelValue:l.value.members_qty,"onUpdate:modelValue":a[1]||(a[1]=e=>l.value.members_qty=e),modelModifiers:{number:!0},dense:"",clearable:"","lazy-rules":"",type:"number",label:"members quantity",onFocus:d,rules:[e=>e>0||"members quantity > 0"]},null,8,["modelValue","rules"])]),g("div",le,[t(v,{class:"col-6 q-pr-sm",outlined:"",modelValue:l.value.universe,"onUpdate:modelValue":a[2]||(a[2]=e=>l.value.universe=e),modelModifiers:{number:!0},dense:"",clearable:"","lazy-rules":"",type:"number",label:"universe",onFocus:d,rules:[e=>e>0||"universe > 0"]},null,8,["modelValue","rules"]),t(v,{class:"col-6 q-pl-sm",outlined:"",modelValue:l.value.break,"onUpdate:modelValue":a[3]||(a[3]=e=>l.value.break=e),modelModifiers:{number:!0},dense:"",clearable:"","lazy-rules":"",type:"number",label:"break",onFocus:d,rules:[e=>e>0||"break > 0"]},null,8,["modelValue","rules"])]),g("div",oe,[t(v,{class:"col-6 q-pr-sm",outlined:"",modelValue:l.value.device_id,"onUpdate:modelValue":a[4]||(a[4]=e=>l.value.device_id=e),modelModifiers:{number:!0},dense:"",clearable:"","lazy-rules":"",type:"number",label:"device_id",onFocus:d,rules:[e=>e>=0||"device_id >= 0"]},null,8,["modelValue","rules"]),t(v,{class:"col-6 q-pl-sm",outlined:"",modelValue:l.value.addr,"onUpdate:modelValue":a[5]||(a[5]=e=>l.value.addr=e),dense:"",clearable:"","lazy-rules":"",label:"addr",onFocus:d,rules:[e=>e&&e.length>0||"addr length >= 0"]},null,8,["modelValue","rules"])]),t(v,{class:"",outlined:"",modelValue:l.value.mode,"onUpdate:modelValue":a[6]||(a[6]=e=>l.value.mode=e),modelModifiers:{number:!0},dense:"",clearable:"","lazy-rules":"",type:"number",label:"mode",onFocus:d,rules:[e=>e>=0||"mode >= 0"]},null,8,["modelValue","rules"]),g("div",ae,[i.value=="Update"?(_(),N(O,{key:0},[t(D,{dense:"",outline:"",unelevated:"",color:"negative",icon:"add",round:"",onClick:F}),t(D,{dense:"",outline:"",unelevated:"",color:"negative",icon:"remove",round:"",onClick:Q})],64)):S("",!0),t(D,{class:"q-px-md",dense:"",outline:"",rounded:"","no-caps":"",unelevated:"",label:"Reset",type:"reset",color:"primary",icon:"restart_alt"}),t(D,{class:"q-px-md",dense:"",outline:"",rounded:"","no-caps":"",unelevated:"",label:i.value,type:"button",color:"primary",icon:"cloud_upload",onClick:U},null,8,["label"])])]),_:1})],64)):S("",!0)]),_:1}))}});export{Ve as default};
