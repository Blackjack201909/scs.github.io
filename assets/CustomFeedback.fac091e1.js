import{Q as U}from"./QToolbarTitle.5e2b8a84.js";import{Q as V}from"./QToolbar.582a7924.js";import{Q as k}from"./QItemLabel.95b24a48.js";import{d as O,r as d,l as $,m,n as E,p as n,j as o,q as _,s as g,x as y,y as x,B as j,t as p,A as I,F as h,H as T,Q as v,aT as L}from"./index.4f390c6a.js";import{Q as R}from"./QBadge.2339051b.js";import{Q as J}from"./QSpace.6762f1cf.js";import{Q as P}from"./QForm.c09e6959.js";import{Q as H}from"./QPage.e32daf6c.js";import{u as z}from"./use-quasar.4e14d354.js";import{U as M}from"./cloudDB.d318324a.js";import"./axios.ea5872bc.js";import"./constant.a3c7e21e.js";const Y={class:"prompt_box q-mx-md q-py-sm"},G={class:"row justify-end"},K={class:"q-pt-lg"},Q=140,de=O({__name:"CustomFeedback",setup(W){const B=z(),D=["\u60A8\u5DF2\u7ECF\u4F7F\u7528\u8FC7\u672C\u5E94\u7528\u7684\u4E00\u4E9B\u6216\u5168\u90E8\u529F\u80FD\u3002","\u60A8\u5BF9\u4E00\u4E9B\u529F\u80FD\u7684\u7F16\u6392\u975E\u5E38\u8D39\u89E3\u6216\u56F0\u6270\u3002","\u60A8\u5E0C\u671B\u67D0\u4E9B\u529F\u80FD\u5F97\u5230\u6539\u8FDB\u6216\u589E\u52A0\u65B0\u529F\u80FD\u3002"],r=d({bad_experience:"",features_improved:"",new_features:""}),b=d({bad_experience:!1,features_improved:!1,new_features:!1}),e=d(0),i=d("Submit"),w=d(!0),f=d(!0),u=d([]),C=M.getInstance();$(async()=>{var l;try{const a=await C.request("databaseCRUD/get",{query:{collection:"pcf_client_feedbacks",condition:JSON.stringify({user_id:"63f0b49d09e2987cee623af4"})}});console.log("pcf_client_feedbacks res:",a),(l=a==null?void 0:a.data)!=null&&l.length&&(f.value=!1,i.value="Update",a.data.length>1?u.value=a.data.sort((s,t)=>{if(s.created_at&&t.created_at)return t.created_at-s.created_at}):u.value=a.data,F(0))}catch(a){console.error("cloudObj pcf_client_feedbacks:",a)}});async function q(){if(w.value!==!0)B.notify({color:"red-5",textColor:"white",icon:"warning",message:"You need to accept the license and terms first"});else{const l={user_id:"63f0b49d09e2987cee623af4",updated_at:Date.now(),...r.value},a={};f.value?(l.created_at=Date.now(),a.created_at=l.created_at):a._id=u.value[e.value]._id,console.log("conditionData:",a);const s=await C.request("databaseCRUD/update",{query:{collection:"pcf_client_feedbacks",condition:JSON.stringify(a),body:JSON.stringify(l)}});console.log("res db update:",s),s.id&&f.value?(u.value.unshift(l),e.value=0,f.value=!1,i.value="Update"):u.value[e.value]={...u.value[e.value],...l},B.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"Submitted"})}}function A(){r.value={bad_experience:"",features_improved:"",new_features:""},f.value=!0,i.value="Submit"}function S(){e.value>0&&(e.value--,F(e.value))}function N(){e.value<u.value.length-1&&(e.value++,F(e.value))}function F(l){r.value={bad_experience:u.value[l].bad_experience,features_improved:u.value[l].features_improved,new_features:u.value[l].new_features},i.value="Update"}return(l,a)=>(m(),E(H,{class:"q-mx-md"},{default:n(()=>[o(V,null,{default:n(()=>[o(U,{class:"text-center"},{default:n(()=>[_(" \u60A8\u7684\u610F\u89C1\u548C\u5EFA\u8BAE\u5BF9\u6211\u4EEC\u975E\u5E38\u91CD\u8981 ")]),_:1})]),_:1}),g("div",Y,[(m(),y(h,null,x(D,(s,t)=>o(I,{key:t,dense:""},{default:n(()=>[o(j,null,{default:n(()=>[o(k,null,{default:n(()=>[_(p(`${t+1}. `)+p(s),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)),64))]),o(P,{onSubmit:q,onReset:A,class:""},{default:n(()=>[(m(!0),y(h,null,x(r.value,(s,t)=>(m(),E(T,{key:t,class:"q-my-md",outlined:"",autofocus:"",clearable:"",maxlength:Q,debounce:"300",type:s.length>30?"textarea":"text",modelValue:r.value[t],"onUpdate:modelValue":c=>r.value[t]=c,label:t+":",hint:b.value[t]?`\u5269\u4F59 ${Q-s.length} \u5B57`:"","lazy-rules":"",rules:[c=>c&&c.length>0||"Please type something"],onClear:c=>r.value[t]="",onFocus:c=>b.value[t]=!0,onBlur:c=>b.value[t]=!1},null,8,["type","modelValue","onUpdate:modelValue","label","hint","rules","onClear","onFocus","onBlur"]))),128)),g("div",G,[u.value.length>1?(m(),y(h,{key:0},[o(v,{dense:"",label:"<",disable:e.value<=0,color:e.value<=0?"grey":"secondary",round:"",class:"q-mr-sm",onClick:S},null,8,["disable","color"]),o(v,{dense:"",label:">",disable:e.value>=u.value.length-1,color:e.value>=u.value.length-1?"grey":"secondary",round:"",onClick:N},null,8,["disable","color"]),o(R,{class:"q-ml-md",dense:"",color:"grey-5"},{default:n(()=>[_(p(e.value+1)+" / "+p(u.value.length),1)]),_:1}),o(J)],64)):L("",!0),o(v,{dense:"",label:"Reset",type:"reset",color:"primary",flat:""}),o(v,{class:"q-ml-sm",dense:"",label:i.value,type:"submit",color:"primary"},null,8,["label"])])]),_:1}),g("div",K,[o(v,{class:"full-width",rounded:"",type:"button",color:"green"},{default:n(()=>[_(p("\u70B9\u51FB\u6B64\u5904\uFF0C\u4E86\u89E3\u4E92\u52A8\u55B7\u6CC9\u66F4\u591A\u4FE1\u606F\u3002"))]),_:1})])]),_:1}))}});export{de as default};
