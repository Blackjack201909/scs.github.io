import{d as ae,r as p,l as oe,w as te,m as r,n as V,p as c,j as t,x as O,aT as E,F as x,s as d,H as k,v as f,U as se,A as $,B as D,t as C,y as F,bc as ue,br as I,z as P,aO as j,Q as J}from"./index.4f390c6a.js";import{Q as ne}from"./QSelect.8ad877e3.js";import{Q as ie}from"./QForm.c09e6959.js";import{Q as de}from"./QPage.e32daf6c.js";import{u as re}from"./use-quasar.4e14d354.js";import{_ as ce}from"./CollectionSelect.2d35001e.js";import{_ as me}from"./UpdatedDate.47641b74.js";import{_ as ve}from"./GroupSelect.989d4c58.js";import{c as R,s as z}from"./pageMethods.76050f51.js";import{u as pe}from"./SearchKey.a606d0cd.js";import{u as L}from"./vue-i18n.runtime.b0371a81.js";import"./QChip.17ac3977.js";import"./QItemLabel.95b24a48.js";import"./QMenu.75c03351.js";import"./selection.1482bdb7.js";import"./rtl.0738a96b.js";import"./format.6396bb17.js";import"./cloudDB.d318324a.js";import"./axios.ea5872bc.js";import"./constant.a3c7e21e.js";import"./index.d9f23821.js";import"./index.4024674e.js";import"./date.865a2574.js";const fe={class:"row col justify-between"},_e={class:"row col justify-between"},be={class:"row col justify-between"},ye={class:"row col justify-between"},ge={class:"q-my-md rounded-borders",style:{border:"1px lightgrey solid"}},he={class:"row justify-around"},we={class:"q-my-md rounded-borders",style:{border:"1px lightgrey solid"}},Se={class:"q-gutter-x-lg q-gutter-y-xs"},Ve={class:"q-my-md rounded-borders",style:{border:"1px lightgrey solid"}},ke={class:"q-gutter-x-lg q-gutter-y-xs"},qe={class:"q-my-lg row justify-between"},Ge=ae({__name:"ShowEditor",setup(Ne){const B=re(),h=pe(),{t:u}=L(),{locale:Y}=L({useScope:"global"}),m=p("submit"),b=p(""),T=p(!0);let U;const v=p(),H=["regular","free","customized"],w=p([]),q=p(""),_=p([]),N=p(""),y=p([]),g=p([]),Q={fountain_id:"",name:"",state:2,type:"free",discount:0,ad_price:2e4,customized_price:1e6,message_price:2e4,notice_prices:new Array(_.value.length).fill(2e3),days_months:"",weekdays:[],cancel_flags:[]},e=p(JSON.parse(JSON.stringify(Q)));oe(async()=>{h.isEnable||h.toggleEnable(),h.isShow&&h.toggleShow()}),te(()=>Y.value,o=>{console.log("watch locale.value",o);const a=w.value.indexOf(q.value);w.value=u("show_types").split(","),console.log("watch showTypes.value:",w.value),q.value=a>-1?w.value[a]:w.value[0];const l=_.value.indexOf(N.value);_.value=u("notice_types").split(","),N.value=l>-1?_.value[l]:_.value[0];const n=u("weekdays").split(",");for(let i=0;i<n.length;i++)y.value[i]?y.value[i].label=n[i]:y.value[i]={label:n[i],isEnable:!1},g.value[i]?g.value[i].label=n[i]:g.value[i]={label:n[i],isEnable:!1}},{immediate:!0});function K(){h.getShow||h.toggleShow()}function G(){h.getShow&&h.toggleShow()}function W(){U?e.value=JSON.parse(JSON.stringify(U)):(e.value=JSON.parse(JSON.stringify(Q)),y.value.forEach(o=>o.isEnable=!1),g.value.forEach(o=>o.isEnable=!1),m.value="submit")}async function X(){B.notify({type:"positive",position:"center",timeout:0,icon:"cloud_done",message:`${m.value} Program: ${e.value.name} ?`,actions:[{label:"Cancel",color:"white",handler:()=>{}},{label:"Yes",color:"yellow",handler:async()=>{if(console.log("onSubmit formData:",e.value),e.value&&v.value){let o="positive",a=" Successfully.";e.value.type=H[w.value.indexOf(q.value)];const l=[];for(const s in y.value)y.value[s].isEnable&&l.push(Number(s));e.value.weekdays=l;const n=[];for(const s in g.value)g.value[s].isEnable&&n.push(Number(s));e.value.cancel_flags=n,e.value.fountain_id=b.value;const i=e.value._id?{_id:e.value._id}:{fountain_id:b.value,name:e.value.name},A=Date.now(),S={...e.value,_id:void 0,updated_at:A};S.created_at||(S.created_at=A),console.log("onSubmit body:",S);try{const s=await R.request("databaseCRUD/update",{query:{collection:"pcf-shows",condition:JSON.stringify(i),body:JSON.stringify(S)}});console.log("onSubmit res:",s),s.affectedDocs>0||s.id?(e.value.created_at||(e.value.created_at=S.created_at),e.value.updated_at=S.updated_at,m.value==="submit"?(e.value.created_at||(e.value.created_at=S.created_at),e.value.updated_at=S.updated_at,s.id&&(e.value._id=s.id,a=`Doc: ${s.id} Added`+a),m.value="update"):m.value==="update"&&(a=`${s.affectedDocs} Doc Updated`+a),v.value={...e.value}):(o="negative",a="No Doc Updated."),z(o,a)}catch(s){a=typeof s=="string"?s:JSON.stringify(s),z("negative",a)}}}}]})}function M(){e.value=JSON.parse(JSON.stringify(Q)),e.value._id="newDoc",e.value.fountain_id=b.value,U=void 0,v.value=e.value,m.value="submit"}function Z(){B.notify({message:`Delete ${e.value.name} ?`,type:"negative",position:"center",icon:"cloud_done",timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>{}},{label:"Yes",color:"yellow",handler:async()=>{if(m.value=="update"&&e.value._id!=="newDoc"&&v.value){let o="positive",a=" Successfully.";try{const l=await R.request("databaseCRUD/delete",{query:{collection:"pcf-shows",condition:JSON.stringify({fountain_id:b.value,_id:e.value._id})}});console.log("onDelete program res:",l),(l==null?void 0:l.deleted)===1?(v.value.name="***deleted doc***",o="warning",a=`${l.affectedDocs} Doc Deleted`+a):(o="negative",a="No Doc Deleted."),z(o,a)}catch(l){a=typeof l=="string"?l:JSON.stringify(l),z("negative",a)}}}}]})}function ee(o){console.log("onFountainPick id:",o._id),o&&o._id!==b.value&&(b.value=o._id,T.value=!1)}async function le(o){if(console.log("onShowPick doc:",o),o){if(o._id!==e.value._id){e.value=JSON.parse(JSON.stringify(o)),y.value.forEach(a=>a.isEnable=!1);for(const a of e.value.weekdays)y.value[a].isEnable=!0;if(e.value.cancel_flags){g.value.forEach(a=>a.isEnable=!1);for(const a of e.value.cancel_flags)g.value[a].isEnable=!0}e.value.ad_price||(e.value.ad_price=2e4),e.value.customized_price||(e.value.ad_price=2e5),e.value.message_price||(e.value.message_price=2e3),e.value.notice_prices||(e.value.notice_prices=new Array(_.value.length).fill(1e3)),!e.value.created_at&&e.value.updated_at&&(e.value.created_at=e.value.updated_at),console.log("onShowPick formData.value:",e.value),o._id==="newDoc"?(v.value=e.value,m.value="submit"):(v.value=JSON.parse(JSON.stringify(o)),m.value="update")}}else U=o,M()}return(o,a)=>(r(),V(de,{padding:"",class:"q-mx-sm"},{default:c(()=>[t(ce,{enable_search:T.value,onSelected:ee,onClick:K},null,8,["enable_search"]),b.value?(r(),O(x,{key:0},[t(ve,{class:"q-mt-sm",collection:"pcf-shows",id:b.value,doc:v.value,onSelected:le,onClick:G},null,8,["id","doc"]),e.value.created_at&&e.value.updated_at?(r(),V(me,{key:0,class:"q-my-md",created_at:e.value.created_at,updated_at:e.value.updated_at},null,8,["created_at","updated_at"])):E("",!0),t(ie,{class:"q-mt-lg",onSubmit:X,onReset:W},{default:c(()=>[v.value?(r(),O(x,{key:0},[d("div",fe,[t(k,{class:"col-6 q-pr-sm",modelValue:e.value.name,"onUpdate:modelValue":a[0]||(a[0]=l=>e.value.name=l),label:f(u)("manage_form.name"),hint:"",outlined:"",dense:"",clearable:"","lazy-rules":"",rules:[l=>l.length>0||"Please type something"]},null,8,["modelValue","label","rules"]),t(k,{class:"col-6 q-pl-sm",outlined:"",modelValue:e.value.discount,"onUpdate:modelValue":a[1]||(a[1]=l=>e.value.discount=l),modelModifiers:{number:!0},type:"number",label:f(u)("manage_form.discount"),hint:"",dense:"",clearable:"","lazy-rules":"",rules:[l=>l>0||"Please type something"]},null,8,["modelValue","label","rules"])]),d("div",_e,[t(k,{class:"col-6 q-pr-sm",outlined:"",modelValue:e.value.days_months,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.days_months=l),label:f(u)("manage_form.days_months"),hint:"",dense:"",clearable:"","lazy-rules":"",rules:[l=>l.length>=0||"days_months"]},null,8,["modelValue","label","rules"]),t(k,{class:"col-6 q-pl-sm",outlined:"",modelValue:e.value.ad_price,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.ad_price=l),modelModifiers:{number:!0},type:"number",label:f(u)("manage_form.ad_price"),hint:"",dense:"",clearable:"","lazy-rules":"",rules:[l=>l>=0||"ad_price >= 0"]},null,8,["modelValue","label","rules"])]),d("div",be,[t(k,{class:"col-6 q-pr-sm",disable:w.value.indexOf(q.value)<2,outlined:"",modelValue:e.value.customized_price,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.customized_price=l),modelModifiers:{number:!0},type:"number",label:f(u)("manage_form.customized_price"),hint:"",dense:"",clearable:"","lazy-rules":"",rules:[l=>l>=0||"customized price >= 0"]},null,8,["disable","modelValue","label","rules"]),t(k,{class:"col-6 q-pl-sm",outlined:"",modelValue:e.value.message_price,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.message_price=l),modelModifiers:{number:!0},type:"number",label:f(u)("manage_form.message_price"),hint:"",dense:"",clearable:"","lazy-rules":"",rules:[l=>l>=0||"message price >= 0"]},null,8,["modelValue","label","rules"])]),d("div",ye,[t(ne,{class:"col-6 q-pr-sm",outlined:"",modelValue:N.value,"onUpdate:modelValue":a[6]||(a[6]=l=>N.value=l),options:_.value,dense:"","options-dense":!1,label:f(u)("manage_form.notice_type"),"hide-dropdown-icon":"","stack-label":""},{append:c(()=>[t(se,{name:""})]),_:1},8,["modelValue","options","label"]),e.value.notice_prices&&_.value.length?(r(),V(k,{key:0,class:"col-6 q-pl-sm",outlined:"",modelValue:e.value.notice_prices[_.value.indexOf(N.value)],"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.notice_prices[_.value.indexOf(N.value)]=l),modelModifiers:{number:!0},type:"number",label:f(u)("manage_form.notice_price"),hint:"",dense:"",clearable:"","lazy-rules":"",rules:[l=>l>=0||"notice_price >= 0"]},null,8,["modelValue","label","rules"])):E("",!0)]),d("div",ge,[t($,null,{default:c(()=>[t(D,{class:"",avatar:""},{default:c(()=>[d("div",null,C(f(u)("manage_form.type")),1)]),_:1}),t(D,{class:""},{default:c(()=>[d("div",he,[(r(!0),O(x,null,F(w.value,l=>(r(),V(ue,{key:l,modelValue:q.value,"onUpdate:modelValue":a[8]||(a[8]=n=>q.value=n),val:l,label:l,dense:""},null,8,["modelValue","val","label"]))),128))])]),_:1})]),_:1})]),d("div",we,[t($,null,{default:c(()=>[t(D,{class:"q-mr-md",avatar:""},{default:c(()=>[d("div",null,C(f(u)("manage_form.weekdays")),1)]),_:1}),t(D,{class:""},{default:c(()=>[d("div",Se,[(r(!0),O(x,null,F(y.value,l=>(r(),V(I,{key:l.label,modelValue:l.isEnable,"onUpdate:modelValue":n=>l.isEnable=n,label:l.label,dense:""},null,8,["modelValue","onUpdate:modelValue","label"]))),128))])]),_:1})]),_:1})]),d("div",Ve,[t($,null,{default:c(()=>[t(D,{class:"q-mr-sm",avatar:""},{default:c(()=>[d("div",null,C(f(u)("manage_form.cancel_flags")),1)]),_:1}),t(D,{class:""},{default:c(()=>[d("div",ke,[(r(!0),O(x,null,F(g.value,l=>(r(),V(I,{key:l.label,modelValue:l.isEnable,"onUpdate:modelValue":n=>l.isEnable=n,label:l.label,dense:""},null,8,["modelValue","onUpdate:modelValue","label"]))),128))])]),_:1})]),_:1})])],64)):E("",!0),P(d("div",qe,[t(J,{dense:"",outline:"",color:"negative",icon:"add",round:"",onClick:M}),m.value=="update"?(r(),V(J,{key:0,dense:"",outline:"",color:"negative",icon:"remove",round:"",onClick:Z})):E("",!0),P(t(J,{class:"q-px-md",dense:"","no-caps":"",unelevated:"",label:o.$t("manage_form.reset"),type:"reset",color:"primary",icon:"restart_alt",outline:"",rounded:""},null,8,["label"]),[[j,v.value]]),P(t(J,{class:"q-px-md",dense:"",outline:"","no-caps":"",unelevated:"",label:o.$t(`manage_form.${m.value}`),type:"submit",color:"primary",icon:"cloud_upload",rounded:""},null,8,["label"]),[[j,v.value]])],512),[[j,b.value]])]),_:1})],64)):E("",!0)]),_:1}))}});export{Ge as default};
