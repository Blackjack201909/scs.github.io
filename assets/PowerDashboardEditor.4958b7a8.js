import{d as A,r as f,w as N,m,n as w,p as g,j as n,x as U,U as H,v as P,bb as R,Q as b,z as I,aO as E,s as _,H as p,A as G,B as x,F as q,y as L,bc as M,aT as j}from"./index.4f390c6a.js";import{Q as T}from"./QFile.0b5cf431.js";import{Q as Y}from"./QForm.c09e6959.js";import{Q as K}from"./QPage.e32daf6c.js";import{u as W}from"./use-quasar.4e14d354.js";import{u as X}from"./SearchKey.a606d0cd.js";import{_ as Z}from"./CollectionSelect.2d35001e.js";import{_ as ee}from"./GroupSelect.989d4c58.js";import{U as le}from"./cloudDB.d318324a.js";import{m as te}from"./constant.a3c7e21e.js";import{_ as ae}from"./UpdatedDate.47641b74.js";import"./QChip.17ac3977.js";import"./format.6396bb17.js";import"./QSelect.8ad877e3.js";import"./QItemLabel.95b24a48.js";import"./QMenu.75c03351.js";import"./selection.1482bdb7.js";import"./rtl.0738a96b.js";import"./index.d9f23821.js";import"./index.4024674e.js";import"./axios.ea5872bc.js";import"./date.865a2574.js";const oe={class:"q-mb-md rounded-borders",style:{border:"1px lightgrey solid"}},se=_("div",null,"state",-1),ne={class:"q-gutter-x-lg q-gutter-y-sm"},ie={class:"q-mt-lg q-mb-xl row justify-between"},je=A({__name:"PowerDashboardEditor",setup(ue){const D=W(),h=X(),r=f("Submit"),y=f(null),d=f(),c=f(),s=f({day:"",night:"",projectors:"",lasers:"",lightings:"",statuses:""}),S={name:"",state:1},a=f({...S}),V=le.getInstance();N(()=>s.value,async t=>{if(console.log("watch combo.value:",t),t){let l;for(l in s.value)s.value[l]&&(a.value[l]=s.value[l].split(",").map(e=>e.trim()))}},{deep:!0}),N(()=>y.value,async t=>{if(console.log("watch docFile:",t),t){const l=await t.arrayBuffer(),o=new TextDecoder("utf-8").decode(new Uint8Array(l)),{docs:i}=JSON.parse(o);i.length&&(r.value="Submit",await F(i))}});function Q(){h.getShow||h.toggleShow()}function k(){h.getShow&&h.toggleShow()}async function F(t){if(console.log("updateDocs2Cloud docs:",t),t!=null&&t.length){let l="positive",e=" Added Successfully.";try{const o=await V.request("databaseCRUD/update",{query:{collection:"pcf-power-dashboards",condition:JSON.stringify({fountain_id:c.value})},body:JSON.stringify(t)});console.log("updateGroupDocs res:",o),o.inserted>0&&o.ids?e=`${o.inserted} MA2 Group Data`+e:(l="negative",e="No Doc Updated."),v(l,e)}catch(o){e=typeof o=="string"?o:JSON.stringify(o),v("negative",e)}}}function v(t,l){D.notify({type:t,message:l,icon:"cloud_done",position:"top",timeout:5e3})}async function $(){D.notify({type:"positive",position:"center",timeout:0,icon:"cloud_done",message:`${r.value} Switch Command: ${a.value.name} ?`,actions:[{label:"Cancel",color:"white",handler:()=>{}},{label:"Yes",color:"yellow",handler:async()=>{if(console.log("onSubmit formData:",a.value),a.value&&d.value){let t="positive",l=" Successfully.";const e=a.value._id!=="newDoc"?{_id:a.value._id}:{fountain_id:c.value,name:a.value.name},o=Date.now(),i={...a.value,_id:void 0,updated_at:o};i.created_at||(i.created_at=o),console.log("onSubmit body:",i);try{const u=await V.request("databaseCRUD/update",{query:{collection:"pcf-power-dashboards",condition:JSON.stringify(e)},body:i});console.log("onSubmit doc res:",u),u.affectedDocs>0||u.id?(a.value.created_at||(a.value.created_at=i.created_at),a.value.updated_at=i.updated_at,r.value==="Submit"?(u.id&&(a.value._id=u.id,l=`Doc: ${u.id} Added`+l),r.value="Update"):r.value==="Update"&&(l=`${u.affectedDocs} Doc Updated`+l),d.value={...a.value}):(t="negative",l="No Doc Updated."),v(t,l)}catch(u){l=typeof u=="string"?u:JSON.stringify(u),v("negative",l)}}}}]})}function O(){a.value={...a.value,...S},s.value={day:"",night:"",projectors:"",lasers:"",lightings:"",statuses:""}}function C(){a.value={...S},a.value._id="newDoc",a.value.fountain_id=c.value,s.value={day:"",night:"",projectors:"",lasers:"",lightings:"",statuses:""},d.value=a.value,r.value="Submit"}function z(){D.notify({message:`Delete Switch Command: ${a.value.name} ?`,color:"negative",position:"center",icon:"cloud_done",timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>{}},{label:"Yes",color:"yellow",handler:async()=>{if(a.value._id!=="newDoc"&&d.value){let t="positive",l=" Successfully.";try{const e=await V.request("databaseCRUD/delete",{query:{collection:"pcf-power-dashboards",condition:JSON.stringify({_id:a.value._id})}});console.log("onDelete doc res:",e),(e==null?void 0:e.deleted)===1?(d.value.name="***deleted doc***",t="warning",l=`${e.affectedDocs} Doc Deleted`+l):(t="negative",l="No Doc Deleted."),v(t,l)}catch(e){l=typeof e=="string"?e:JSON.stringify(e),v("negative",l)}}}}]})}function B(t){console.log("onFountainPick data:",t),t&&t._id!==c.value&&(c.value=t._id)}async function J(t){var l,e;if(console.log("onDocumentPick doc:",t),t){a.value={...t},s.value={day:"",night:"",projectors:"",lasers:"",lightings:"",statuses:""};let o;for(o in s.value)t[o]&&t[o]instanceof Array&&((l=t[o])==null?void 0:l.length)&&(s.value[o]=(e=t[o])==null?void 0:e.join(" , "));t._id==="newDoc"?(d.value=a.value,r.value="Submit"):(d.value={...t},r.value="Update")}else C()}return(t,l)=>(m(),w(K,{padding:"",class:"q-mx-sm"},{default:g(()=>[n(Z,{class:"q-mt-md",onSelected:B,onClick:Q}),c.value?(m(),U(q,{key:0},[n(ee,{class:"q-mt-sm",collection:"pcf-power-dashboards",id:c.value,doc:d.value,onSelected:J,onClick:k},null,8,["id","doc"]),n(T,{class:"q-mt-md",dense:"",outlined:"",modelValue:y.value,"onUpdate:modelValue":l[1]||(l[1]=e=>y.value=e),label:"load json file",accept:".json"},{append:g(()=>[y.value?(m(),w(H,{key:0,name:P(te),onClick:l[0]||(l[0]=R(e=>y.value=null,["stop","prevent"])),class:"cursor-pointer",color:"grey-5"},null,8,["name"])):(m(),w(b,{key:1,round:"",dense:"",flat:"",icon:"folder_open"}))]),_:1},8,["modelValue"]),I(_("div",null,[n(ae,{class:"q-mt-md",created_at:a.value.created_at,updated_at:a.value.updated_at},null,8,["created_at","updated_at"])],512),[[E,a.value.created_at&&a.value.updated_at]]),n(Y,{class:"q-mt-lg",autofocus:"",onSubmit:$,onReset:O},{default:g(()=>[n(p,{class:"",modelValue:a.value.name,"onUpdate:modelValue":l[2]||(l[2]=e=>a.value.name=e),label:"name",hint:"",outlined:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>e&&e.length>0||"Name length > 0"],onFocus:k},null,8,["modelValue","rules"]),n(p,{class:"",modelValue:s.value.day,"onUpdate:modelValue":l[3]||(l[3]=e=>s.value.day=e),label:"day",hint:"",outlined:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>typeof e=="string"||"Hex string"]},null,8,["modelValue","rules"]),n(p,{class:"",outlined:"",modelValue:s.value.night,"onUpdate:modelValue":l[4]||(l[4]=e=>s.value.night=e),label:"night",hint:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>typeof e=="string"||"Hex string"]},null,8,["modelValue","rules"]),n(p,{class:"",outlined:"",modelValue:s.value.projectors,"onUpdate:modelValue":l[5]||(l[5]=e=>s.value.projectors=e),label:"projectors",hint:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>typeof e=="string"||"Hex string"]},null,8,["modelValue","rules"]),n(p,{class:"",outlined:"",modelValue:s.value.lasers,"onUpdate:modelValue":l[6]||(l[6]=e=>s.value.lasers=e),label:"lasers",hint:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>typeof e=="string"||"Hex string"]},null,8,["modelValue","rules"]),n(p,{class:"",outlined:"",modelValue:s.value.lightings,"onUpdate:modelValue":l[7]||(l[7]=e=>s.value.lightings=e),label:"lightings",hint:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>typeof e=="string"||"Hex string"]},null,8,["modelValue","rules"]),n(p,{class:"",outlined:"",modelValue:s.value.statuses,"onUpdate:modelValue":l[8]||(l[8]=e=>s.value.statuses=e),label:"statuses",hint:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>typeof e=="string"||"Hex string"]},null,8,["modelValue","rules"]),_("div",oe,[n(G,null,{default:g(()=>[n(x,{class:"q-mr-lg",avatar:""},{default:g(()=>[se]),_:1}),n(x,{class:""},{default:g(()=>[_("div",ne,[(m(!0),U(q,null,L(t.$t("state.show").split(","),(e,o)=>(m(),w(M,{key:o,modelValue:a.value.state,"onUpdate:modelValue":l[9]||(l[9]=i=>a.value.state=i),val:o,label:e,dense:""},null,8,["modelValue","val","label"]))),128))])]),_:1})]),_:1})]),_("div",ie,[r.value=="Update"?(m(),U(q,{key:0},[n(b,{dense:"",outline:"",color:"negative",icon:"add",round:"",onClick:C}),n(b,{dense:"",outline:"",color:"negative",icon:"remove",round:"",onClick:z})],64)):j("",!0),n(b,{class:"q-px-md",dense:"",outline:"",rounded:"","no-caps":"",unelevated:"",label:"Reset",type:"reset",color:"primary",icon:"restart_alt"}),n(b,{class:"q-px-md",dense:"",outline:"",rounded:"","no-caps":"",unelevated:"",label:r.value,type:"submit",color:"primary",icon:"cloud_upload"},null,8,["label"])])]),_:1})],64)):j("",!0)]),_:1}))}});export{je as default};
