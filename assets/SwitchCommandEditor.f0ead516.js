import{d as E,r as y,w as A,m as h,n as C,p as q,j as n,x as O,U as G,v as M,bb as T,Q as S,z as f,aO as p,s as b,H as c,F as Q,aT as j}from"./index.4f390c6a.js";import{Q as Y}from"./QFile.0b5cf431.js";import{Q as K}from"./QForm.c09e6959.js";import{Q as L}from"./QPage.e32daf6c.js";import{u as W}from"./use-quasar.4e14d354.js";import{u as X}from"./SearchKey.a606d0cd.js";import{_ as Z}from"./CollectionSelect.2d35001e.js";import{_ as ee}from"./GroupSelect.989d4c58.js";import{U as le}from"./cloudDB.d318324a.js";import{m as oe}from"./constant.a3c7e21e.js";import{_ as te}from"./UpdatedDate.47641b74.js";import"./QChip.17ac3977.js";import"./format.6396bb17.js";import"./QSelect.8ad877e3.js";import"./QItemLabel.95b24a48.js";import"./QMenu.75c03351.js";import"./selection.1482bdb7.js";import"./rtl.0738a96b.js";import"./index.d9f23821.js";import"./index.4024674e.js";import"./axios.ea5872bc.js";import"./date.865a2574.js";const ae={class:"q-mt-md row col justify-between"},ne={class:"q-my-lg row justify-between"},Fe=E({__name:"SwitchCommandEditor",setup(se){const V=W(),D=X(),i=y("Submit"),_=y(null),d=y(),m=y(),v=y(""),U={name:"",on:"",off:"",motor:"",mask:"",status:"",method:"",members:[]},l=y({...U}),k=le.getInstance();A(()=>v.value,async t=>{console.log("watch members.value:",t),t&&(l.value.members=t.split(",").map(o=>o.trim()))}),A(()=>_.value,async t=>{if(console.log("watch docFile:",t),t){const o=await t.arrayBuffer(),s=new TextDecoder("utf-8").decode(new Uint8Array(o)),{docs:w}=JSON.parse(s);w.length&&(i.value="Submit",await H(w))}});function z(){D.getShow||D.toggleShow()}function F(){D.getShow&&D.toggleShow()}async function H(t){if(console.log("updateDocs2Cloud docs:",t),t!=null&&t.length){let o="positive",e=" Added Successfully.";try{const s=await k.request("databaseCRUD/update",{query:{collection:"pcf-switch-commands",condition:JSON.stringify({fountain_id:m.value})},body:JSON.stringify(t)});console.log("updateGroupDocs res:",s),s.inserted>0&&s.ids?e=`${s.inserted} MA2 Group Data`+e:(o="negative",e="No Doc Updated."),g(o,e)}catch(s){e=typeof s=="string"?s:JSON.stringify(s),g("negative",e)}}}function g(t,o){V.notify({type:t,message:o,icon:"cloud_done",position:"top",timeout:5e3})}async function N(){console.log("onSubmit entry!"),V.notify({type:"positive",position:"center",timeout:0,icon:"cloud_done",message:`${i.value} Switch Command: ${l.value.name} ?`,actions:[{label:"Cancel",color:"white",handler:()=>{}},{label:"Yes",color:"yellow",handler:async()=>{var t,o,e,s;if(console.log("onSubmit formData:",l.value),l.value&&d.value){let w="positive",r=" Successfully.";const I=l.value._id!=="newDoc"?{_id:l.value._id}:{fountain_id:m.value,name:l.value.name},$=Date.now(),a={...l.value,_id:void 0,updated_at:$};(t=a.motor)!=null&&t.length||(a.motor=void 0),(!((o=a.on)!=null&&o.length)||!((e=a.off)!=null&&e.length))&&(a.motor=void 0,a.on=void 0,a.off=void 0,a.mask=void 0),(s=a.status)!=null&&s.length||(a.status=void 0,a.method=void 0,a.members=void 0),a.created_at||(a.created_at=$),console.log("onSubmit body:",a);try{const u=await k.request("databaseCRUD/update",{query:{collection:"pcf-switch-commands",condition:JSON.stringify(I)},body:a});console.log("onSubmit doc res:",u),u.affectedDocs>0||u.id?(l.value.created_at||(l.value.created_at=a.created_at),l.value.updated_at=a.updated_at,i.value==="Submit"?(u.id&&(l.value._id=u.id,r=`Doc: ${u.id} Added`+r),i.value="Update"):i.value==="Update"&&(r=`${u.affectedDocs} Doc Updated`+r),d.value={...l.value}):(w="negative",r="No Doc Updated."),g(w,r)}catch(u){r=typeof u=="string"?u:JSON.stringify(u),g("negative",r)}}}}]})}function J(){console.log("onReset entry!"),l.value={...l.value,...U},v.value=""}function x(){l.value={...U},l.value._id="newDoc",l.value.fountain_id=m.value,v.value="",d.value=l.value,i.value="Submit"}function B(){V.notify({message:`Delete Switch Command: ${l.value.name} ?`,color:"negative",position:"center",icon:"cloud_done",timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>{}},{label:"Yes",color:"yellow",handler:async()=>{if(l.value._id!=="newDoc"&&d.value){let t="positive",o=" Successfully.";try{const e=await k.request("databaseCRUD/delete",{query:{collection:"pcf-switch-commands",condition:JSON.stringify({_id:l.value._id})}});console.log("onDelete doc res:",e),(e==null?void 0:e.deleted)===1?(d.value.name="***deleted doc***",t="warning",o=`${e.affectedDocs} Doc Deleted`+o):(t="negative",o="No Doc Deleted."),g(t,o)}catch(e){o=typeof e=="string"?e:JSON.stringify(e),g("negative",o)}}}}]})}function R(t){console.log("onFountainPick data:",t),t&&t._id!==m.value&&(m.value=t._id)}async function P(t){console.log("onDocumentPick doc:",t),t?(l.value={...t},v.value="",l.value.members&&l.value.members.length&&(v.value=l.value.members.join(" , ")),t._id==="newDoc"?(d.value=l.value,i.value="Submit"):(d.value={...t},i.value="Update")):x()}return(t,o)=>(h(),C(L,{padding:"",class:"q-mx-sm"},{default:q(()=>[n(Z,{class:"q-mt-md",onSelected:R,onClick:z}),m.value?(h(),O(Q,{key:0},[n(ee,{class:"q-mt-sm",collection:"pcf-switch-commands",id:m.value,doc:d.value,onSelected:P,onClick:F},null,8,["id","doc"]),n(Y,{class:"q-mt-md",dense:"",outlined:"",modelValue:_.value,"onUpdate:modelValue":o[1]||(o[1]=e=>_.value=e),label:"load json file",accept:".json"},{append:q(()=>[_.value?(h(),C(G,{key:0,name:M(oe),onClick:o[0]||(o[0]=T(e=>_.value=null,["stop","prevent"])),class:"cursor-pointer",color:"grey-5"},null,8,["name"])):(h(),C(S,{key:1,round:"",dense:"",flat:"",icon:"folder_open"}))]),_:1},8,["modelValue"]),f(b("div",null,[n(te,{class:"q-my-md",created_at:l.value.created_at,updated_at:l.value.updated_at},null,8,["created_at","updated_at"])],512),[[p,l.value.created_at&&l.value.updated_at]]),n(K,{class:"q-mt-lg",autofocus:"",onSubmit:N,onReset:J},{default:q(()=>[b("div",ae,[n(c,{class:"col-6 q-pr-sm",modelValue:l.value.name,"onUpdate:modelValue":o[2]||(o[2]=e=>l.value.name=e),label:"name",hint:"",outlined:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>e&&e.length>0||"Name length > 0"],onFocus:F},null,8,["modelValue","rules"]),f(n(c,{class:"col-6 q-pl-sm",outlined:"",modelValue:l.value.mask,"onUpdate:modelValue":o[3]||(o[3]=e=>l.value.mask=e),label:"mask",hint:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>e===""||/[0-9a-fA-F\s]+/.test(e)||"Hex string"]},null,8,["modelValue","rules"]),[[p,!l.value.status&&l.value.on]]),f(n(c,{class:"col-6 q-pl-sm",outlined:"",modelValue:l.value.method,"onUpdate:modelValue":o[4]||(o[4]=e=>l.value.method=e),label:"method",hint:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>e===""||/[0-9a-fA-F\s]+/.test(e)||"Hex string"]},null,8,["modelValue","rules"]),[[p,!l.value.on&&l.value.status]])]),f(b("div",null,[n(c,{class:"",modelValue:l.value.on,"onUpdate:modelValue":o[5]||(o[5]=e=>l.value.on=e),label:"on",hint:"",outlined:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>e===""||/[0-9a-fA-F\s]+/.test(e)||"Hex string"]},null,8,["modelValue","rules"]),f(b("div",null,[n(c,{class:"",outlined:"",modelValue:l.value.off,"onUpdate:modelValue":o[6]||(o[6]=e=>l.value.off=e),label:"off",hint:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>e===""||/[0-9a-fA-F\s]+/.test(e)||"Hex string"]},null,8,["modelValue","rules"]),n(c,{class:"",outlined:"",modelValue:l.value.motor,"onUpdate:modelValue":o[7]||(o[7]=e=>l.value.motor=e),label:"motor",hint:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>e===""||/[0-9a-fA-F\s]+/.test(e)||"Hex string"]},null,8,["modelValue","rules"])],512),[[p,l.value.on]])],512),[[p,!l.value.status]]),f(b("div",null,[n(c,{class:"",outlined:"",modelValue:l.value.status,"onUpdate:modelValue":o[8]||(o[8]=e=>l.value.status=e),label:"status",hint:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>e===""||/[0-9a-fA-F\s]+/.test(e)||"Hex string"]},null,8,["modelValue","rules"]),f(n(c,{class:"",outlined:"",modelValue:v.value,"onUpdate:modelValue":o[9]||(o[9]=e=>v.value=e),label:"members",hint:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>e&&e.length>0||"Hex string"]},null,8,["modelValue","rules"]),[[p,l.value.status]])],512),[[p,!l.value.on]]),b("div",ne,[i.value=="Update"?(h(),O(Q,{key:0},[n(S,{dense:"",outline:"",unelevated:"",color:"negative",icon:"add",round:"",onClick:x}),n(S,{dense:"",outline:"",unelevated:"",color:"negative",icon:"remove",round:"",onClick:B})],64)):j("",!0),n(S,{class:"q-px-md",dense:"",outline:"",rounded:"","no-caps":"",unelevated:"",label:"Reset",type:"reset",color:"primary",icon:"restart_alt"}),n(S,{class:"q-px-md",dense:"",outline:"",rounded:"","no-caps":"",unelevated:"",label:i.value,type:"button",color:"primary",icon:"cloud_upload",onClick:N},null,8,["label"])])]),_:1})],64)):j("",!0)]),_:1}))}});export{Fe as default};
