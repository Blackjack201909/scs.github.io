import{Q as Xe}from"./QChip.17ac3977.js";import{Q as Ze}from"./QTab.9dfb2d2e.js";import{Q as ea}from"./QTabs.1c1f66ed.js";import{Q as aa}from"./QToolbarTitle.5e2b8a84.js";import{Q as la}from"./QToolbar.582a7924.js";import{Q as ta}from"./QPageSticky.0fc5d889.js";import{Q as oa}from"./QPage.e32daf6c.js";import{u as ke}from"./use-quasar.4e14d354.js";import{F as ua,_ as sa}from"./FountainCard.02b690d3.js";import{Q as na}from"./QInnerLoading.b1f69d49.js";import{d as ne,r as u,w as ee,m as p,x,j as i,n as V,p as f,aT as B,t as M,s as A,F as oe,y as ye,z as ce,A as ue,bb as ie,B as X,G as Ue,q as Y,aP as He,aU as Pe,U as re,K as je,M as ia,N as ra,c as G,a_ as ca,a5 as da,a6 as Re,X as va,h as D,a4 as fa,g as ma,by as qe,bz as Se,_ as Ge,v as Z,l as _e,bA as pa,bB as ha,o as Ye,a as be,aV as Ke,Q as he,H as de,aO as we,bt as ga,u as ya,k as _a,b4 as ba,D as Sa}from"./index.4f390c6a.js";import{Q as se}from"./QItemLabel.95b24a48.js";import{Q as ge}from"./QBadge.2339051b.js";import{Q as Ae}from"./QList.423862dd.js";import{Q as Ta,a as wa}from"./QInfiniteScroll.281273f1.js";import{U as Je,c as za,a as $a}from"./cloudDB.d318324a.js";import{d as ze,e as Fa,s as pe,S as te,m as Le,p as Ca,g as ka}from"./constant.a3c7e21e.js";import{Q as xe}from"./QResizeObserver.cb7e3544.js";import{Q as Pa}from"./QScrollObserver.ad751985.js";import{T as Be}from"./TouchPan.5282a72c.js";import{b as me}from"./format.6396bb17.js";import{d as $e}from"./date.865a2574.js";import{_ as Aa}from"./SodPay.96226a02.js";import{Q as Ie}from"./QSelect.8ad877e3.js";import{c as Fe}from"./pageMethods.76050f51.js";import{c as Ea,d as qa}from"./index.d9f23821.js";import{u as Ce}from"./vue-i18n.runtime.b0371a81.js";import{Q as La}from"./QImg.a4aaed75.js";import{Q as xa}from"./QFile.0b5cf431.js";import{u as Ba}from"./SearchKey.a606d0cd.js";import"./rtl.0738a96b.js";import"./axios.ea5872bc.js";import"./selection.1482bdb7.js";import"./QSlider.10d6f0d5.js";import"./QSpace.6762f1cf.js";import"./QMenu.75c03351.js";const Ia={class:"q-py-md"},Da=["src"],Na={class:"row justify-center q-my-md"},Ma={key:1,class:"q-pt-xl text-orange text-h6 text-center"},De=6,Qa=ne({__name:"ProgramsList",props:{typeIndex:{default:0},type:{default:""},typesLength:{default:0},search:{default:""},fountainId:{default:""}},emits:["selected"],setup(T,{emit:r}){const g=u(!0),S=u(""),c=T,$=u([]),n=u([]),t=u([]),z=Je.getInstance(),b=r;ee(()=>c.fountainId,async _=>{var k;if(_){for(;(k=$.value)!=null&&k.length;)$.value.pop(),t.value.pop();$.value=Array(c.typesLength).fill([]),t.value=Array(c.typesLength).fill(!1),await y()}},{immediate:!0}),ee(()=>c.typeIndex,async _=>{console.log("watch props.typeIndex: ",_),t.value[_]?s(c.search):c.search?await y(c.search):await y()}),ee(()=>c.search,async _=>{console.log("watch props.search: ",Boolean(_)),t.value[c.typeIndex]?s(_):await y(_)});async function y(_){var k;try{const F=_&&_.length>0;let L=`fountain_id=='${c.fountainId}' && type=='${c.type}'`;F&&(L+=` && ${new RegExp(_,"i")}.test(name)`),console.log("loadMore where:",L);const q=F?0:$.value[c.typeIndex].length,P=await z.request("getDetails/programsPage",{query:{collection:"pcf-programs",condition:JSON.stringify({where:L,skip:q,limit:De,orderBy:"order asc",mediaField:"_id, name, producer, poster, duration",outWhere:"_id != null",outField:"arrayElemAt(media_id, 0) as media, price, type, tags, fountain_id"})}});if(g.value=!1,!P.success&&((k=P.error)==null?void 0:k.message)){/resource exhausted/.test(P.error.message)?S.value="DB resource exhausted.":S.value=P.error.message;return}if(F)console.log("loadMore isSearch res:",P),n.value=P;else{if(P.length){for(const H of P)H.duration=ze(H.media.duration);$.value[c.typeIndex]=$.value[c.typeIndex].concat(P),n.value=$.value[c.typeIndex]}else $.value[c.typeIndex]=[],n.value=[];P.length<De&&(t.value[c.typeIndex]=!0)}}catch(F){console.error("loadMore ProgramsList:",F)}}function w(_){const k=n.value[_];b("selected",k)}function C(_,k){t.value[c.typeIndex]?k(!0):y(c.search).then(()=>k())}function s(_){if(_){const k=[],F=RegExp(_,"i");for(const L of $.value[c.typeIndex])L.media&&(F.test(L.media.name)||F.test(L.media.producer))&&k.push(L);n.value=k}else n.value=$.value[c.typeIndex]}return(_,k)=>(p(),x("div",Ia,[i(na,{showing:g.value,label:"\u52A0\u8F7D\u8282\u76EE\u6570\u636E ...","label-class":"text-teal","label-style":"font-size: 1.1em"},null,8,["showing"]),!g.value&&n.value.length?(p(),V(Ta,{key:0,onLoad:C,offset:150},{loading:f(()=>[A("div",Na,[i(wa,{color:"primary",size:"40px"})])]),default:f(()=>[i(Ae,{separator:""},{default:f(()=>[(p(!0),x(oe,null,ye(n.value,(F,L)=>ce((p(),V(ue,{key:L,clickable:"",onClick:ie(q=>w(L),["stop"])},{default:f(()=>[i(X,{avatar:""},{default:f(()=>[i(Ue,{size:"xl",rounded:""},{default:f(()=>{var q,P;return[A("img",{src:(P=(q=F.media)==null?void 0:q.poster)==null?void 0:P.url},null,8,Da)]}),_:2},1024)]),_:2},1024),i(X,{class:"justify-around"},{default:f(()=>[i(se,{lines:"1"},{default:f(()=>{var q;return[Y(M((q=F.media)==null?void 0:q.name),1)]}),_:2},1024),i(se,{lines:"1",caption:"",style:{"font-size":"12px"}},{default:f(()=>{var q;return[Y(M((q=F.media)==null?void 0:q.producer),1)]}),_:2},1024)]),_:2},1024),i(X,{side:"",class:"justify-around"},{default:f(()=>[typeof F.duration=="string"?(p(),V(ge,{key:0,outline:"",color:"grey-6",rounded:"",class:"q-px-sm"},{default:f(()=>[Y(M(F.duration),1)]),_:2},1024)):B("",!0),i(ge,{color:"green"},{default:f(()=>[Y(M(F.tags.join("-")),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[He]])),128))]),_:1})]),_:1})):B("",!0),S.value.length?(p(),x("div",Ma,M(S.value),1)):B("",!0)]))}}),Oa=["src"],Va={class:"text-caption"},Ua={class:"text-caption text-weight-thin"},Ha=ne({__name:"ProgramCard",props:{data:{}},setup(T){return(r,g)=>r.data?ce((p(),V(ue,{key:0,clickable:"",dense:"",class:Pe(["q-py-xs",r.$q.dark.isActive?"bg-green-10":"bg-green-2"])},{default:f(()=>[i(X,{avatar:""},{default:f(()=>[i(Ue,{size:"xl",rounded:""},{default:f(()=>{var S,c;return[A("img",{src:(c=(S=r.data.media)==null?void 0:S.poster)==null?void 0:c.url},null,8,Oa)]}),_:1})]),_:1}),i(X,{class:"text-left"},{default:f(()=>{var S,c;return[A("div",Va,M((S=r.data.media)==null?void 0:S.name),1),A("div",Ua,M((c=r.data.media)==null?void 0:c.producer),1)]}),_:1}),i(X,{side:"",class:"justify-around"},{default:f(()=>[i(ge,{color:"grey",outline:"",rounded:"",class:"q-px-sm"},{default:f(()=>[Y(M(r.data.duration),1)]),_:1}),i(ge,{color:"green"},{default:f(()=>[Y(M(r.data.tags.join("-")),1)]),_:1})]),_:1}),i(X,{side:""},{default:f(()=>[i(re,{name:"keyboard_arrow_down"})]),_:1})]),_:1},8,["class"])),[[He]]):B("",!0)}}),Ne=["vertical","horizontal"],Te={vertical:{offset:"offsetY",scroll:"scrollTop",dir:"down",dist:"y"},horizontal:{offset:"offsetX",scroll:"scrollLeft",dir:"right",dist:"x"}},Me={prevent:!0,mouse:!0,mouseAllDir:!0},Qe=T=>T>=250?50:Math.ceil(T/5);var We=je({name:"QScrollArea",props:{...ia,thumbStyle:Object,verticalThumbStyle:Object,horizontalThumbStyle:Object,barStyle:[Array,String,Object],verticalBarStyle:[Array,String,Object],horizontalBarStyle:[Array,String,Object],contentStyle:[Array,String,Object],contentActiveStyle:[Array,String,Object],delay:{type:[String,Number],default:1e3},visible:{type:Boolean,default:null},tabindex:[String,Number],onScroll:Function},setup(T,{slots:r,emit:g}){const S=u(!1),c=u(!1),$=u(!1),n={vertical:u(0),horizontal:u(0)},t={vertical:{ref:u(null),position:u(0),size:u(0)},horizontal:{ref:u(null),position:u(0),size:u(0)}},{proxy:z}=ma(),b=ra(T,z.$q);let y=null,w;const C=u(null),s=G(()=>"q-scrollarea"+(b.value===!0?" q-scrollarea--dark":""));t.vertical.percentage=G(()=>{const e=t.vertical.size.value-n.vertical.value;if(e<=0)return 0;const l=me(t.vertical.position.value/e,0,1);return Math.round(l*1e4)/1e4}),t.vertical.thumbHidden=G(()=>(T.visible===null?$.value:T.visible)!==!0&&S.value===!1&&c.value===!1||t.vertical.size.value<=n.vertical.value+1),t.vertical.thumbStart=G(()=>t.vertical.percentage.value*(n.vertical.value-t.vertical.thumbSize.value)),t.vertical.thumbSize=G(()=>Math.round(me(n.vertical.value*n.vertical.value/t.vertical.size.value,Qe(n.vertical.value),n.vertical.value))),t.vertical.style=G(()=>({...T.thumbStyle,...T.verticalThumbStyle,top:`${t.vertical.thumbStart.value}px`,height:`${t.vertical.thumbSize.value}px`})),t.vertical.thumbClass=G(()=>"q-scrollarea__thumb q-scrollarea__thumb--v absolute-right"+(t.vertical.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),t.vertical.barClass=G(()=>"q-scrollarea__bar q-scrollarea__bar--v absolute-right"+(t.vertical.thumbHidden.value===!0?" q-scrollarea__bar--invisible":"")),t.horizontal.percentage=G(()=>{const e=t.horizontal.size.value-n.horizontal.value;if(e<=0)return 0;const l=me(Math.abs(t.horizontal.position.value)/e,0,1);return Math.round(l*1e4)/1e4}),t.horizontal.thumbHidden=G(()=>(T.visible===null?$.value:T.visible)!==!0&&S.value===!1&&c.value===!1||t.horizontal.size.value<=n.horizontal.value+1),t.horizontal.thumbStart=G(()=>t.horizontal.percentage.value*(n.horizontal.value-t.horizontal.thumbSize.value)),t.horizontal.thumbSize=G(()=>Math.round(me(n.horizontal.value*n.horizontal.value/t.horizontal.size.value,Qe(n.horizontal.value),n.horizontal.value))),t.horizontal.style=G(()=>({...T.thumbStyle,...T.horizontalThumbStyle,[z.$q.lang.rtl===!0?"right":"left"]:`${t.horizontal.thumbStart.value}px`,width:`${t.horizontal.thumbSize.value}px`})),t.horizontal.thumbClass=G(()=>"q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom"+(t.horizontal.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),t.horizontal.barClass=G(()=>"q-scrollarea__bar q-scrollarea__bar--h absolute-bottom"+(t.horizontal.thumbHidden.value===!0?" q-scrollarea__bar--invisible":""));const _=G(()=>t.vertical.thumbHidden.value===!0&&t.horizontal.thumbHidden.value===!0?T.contentStyle:T.contentActiveStyle),k=[[Be,e=>{Q(e,"vertical")},void 0,{vertical:!0,...Me}]],F=[[Be,e=>{Q(e,"horizontal")},void 0,{horizontal:!0,...Me}]];function L(){const e={};return Ne.forEach(l=>{const a=t[l];e[l+"Position"]=a.position.value,e[l+"Percentage"]=a.percentage.value,e[l+"Size"]=a.size.value,e[l+"ContainerSize"]=n[l].value}),e}const q=ca(()=>{const e=L();e.ref=z,g("scroll",e)},0);function P(e,l,a){if(Ne.includes(e)===!1){console.error("[QScrollArea]: wrong first param of setScrollPosition (vertical/horizontal)");return}(e==="vertical"?qe:Se)(C.value,l,a)}function H({height:e,width:l}){let a=!1;n.vertical.value!==e&&(n.vertical.value=e,a=!0),n.horizontal.value!==l&&(n.horizontal.value=l,a=!0),a===!0&&m()}function E({position:e}){let l=!1;t.vertical.position.value!==e.top&&(t.vertical.position.value=e.top,l=!0),t.horizontal.position.value!==e.left&&(t.horizontal.position.value=e.left,l=!0),l===!0&&m()}function I({height:e,width:l}){t.horizontal.size.value!==l&&(t.horizontal.size.value=l,m()),t.vertical.size.value!==e&&(t.vertical.size.value=e,m())}function Q(e,l){const a=t[l];if(e.isFirst===!0){if(a.thumbHidden.value===!0)return;w=a.position.value,c.value=!0}else if(c.value!==!0)return;e.isFinal===!0&&(c.value=!1);const o=Te[l],d=n[l].value,R=(a.size.value-d)/(d-a.thumbSize.value),W=e.distance[o.dist],K=w+(e.direction===o.dir?1:-1)*W*R;j(K,l)}function ae(e,l){const a=t[l];if(a.thumbHidden.value!==!0){const o=e[Te[l].offset];if(o<a.thumbStart.value||o>a.thumbStart.value+a.thumbSize.value){const d=o-a.thumbSize.value/2;j(d/n[l].value*a.size.value,l)}a.ref.value!==null&&a.ref.value.dispatchEvent(new MouseEvent(e.type,e))}}function O(e){ae(e,"vertical")}function U(e){ae(e,"horizontal")}function m(){S.value=!0,y!==null&&clearTimeout(y),y=setTimeout(()=>{y=null,S.value=!1},T.delay),T.onScroll!==void 0&&q()}function j(e,l){C.value[Te[l].scroll]=e}let N=null;function J(){N!==null&&clearTimeout(N),N=setTimeout(()=>{N=null,$.value=!0},z.$q.platform.is.ios?50:0)}function h(){N!==null&&(clearTimeout(N),N=null),$.value=!1}let v=null;return ee(()=>z.$q.lang.rtl,e=>{C.value!==null&&Se(C.value,Math.abs(t.horizontal.position.value)*(e===!0?-1:1))}),da(()=>{v={top:t.vertical.position.value,left:t.horizontal.position.value}}),Re(()=>{if(v===null)return;const e=C.value;e!==null&&(Se(e,v.left),qe(e,v.top))}),va(q.cancel),Object.assign(z,{getScrollTarget:()=>C.value,getScroll:L,getScrollPosition:()=>({top:t.vertical.position.value,left:t.horizontal.position.value}),getScrollPercentage:()=>({top:t.vertical.percentage.value,left:t.horizontal.percentage.value}),setScrollPosition:P,setScrollPercentage(e,l,a){P(e,l*(t[e].size.value-n[e].value)*(e==="horizontal"&&z.$q.lang.rtl===!0?-1:1),a)}}),()=>D("div",{class:s.value,onMouseenter:J,onMouseleave:h},[D("div",{ref:C,class:"q-scrollarea__container scroll relative-position fit hide-scrollbar",tabindex:T.tabindex!==void 0?T.tabindex:void 0},[D("div",{class:"q-scrollarea__content absolute",style:_.value},fa(r.default,[D(xe,{debounce:0,onResize:I})])),D(Pa,{axis:"both",onScroll:E})]),D(xe,{debounce:0,onResize:H}),D("div",{class:t.vertical.barClass.value,style:[T.barStyle,T.verticalBarStyle],"aria-hidden":"true",onMousedown:O}),D("div",{class:t.horizontal.barClass.value,style:[T.barStyle,T.horizontalBarStyle],"aria-hidden":"true",onMousedown:U}),ce(D("div",{ref:t.vertical.ref,class:t.vertical.thumbClass.value,style:t.vertical.style.value,"aria-hidden":"true"}),k),ce(D("div",{ref:t.horizontal.ref,class:t.horizontal.thumbClass.value,style:t.horizontal.style.value,"aria-hidden":"true"}),F)])}});const ja={key:0,class:"row justify-between items-end q-mb-xs"},Ra={class:"col text-center text-bold"},Ga={class:"q-mr-sm",style:{"font-size":"10px"}},Ya=ne({__name:"ShowInfo",props:{data:{},info:{}},setup(T){return(r,g)=>(p(),x("div",null,[r.data?(p(),x("div",ja,[A("div",Ra,M(r.data.name),1),A("div",Ga,M(r.$t(`show_type.${r.data.type}`)),1)])):B("",!0),r.info?(p(),V(We,{key:1,class:"scroll_box"},{default:f(()=>[i(Ae,{separator:"",class:"column col"},{default:f(()=>{var S,c;return[i(ue,{class:"col-2"},{default:f(()=>[i(X,null,{default:f(()=>[i(se,{class:Pe(r.info.status==="init"&&r.info.situation.length<=0?"text-positive":r.info.situation.length>0?"text-grey-7":"")},{default:f(()=>[Y(" \u72B6\u6001\uFF1A"+M(r.info.situation.length>0?r.$t(`show_situation.${r.info.situation}`):r.$t(`program_status.${r.info.status}`)),1)]),_:1},8,["class"])]),_:1})]),_:1}),((S=r.data)==null?void 0:S.discount)&&((c=r.data)==null?void 0:c.discount)>0?(p(),V(ue,{key:0,class:"col-2"},{default:f(()=>[i(X,{class:"text-negative"},{default:f(()=>[i(se,null,{default:f(()=>[Y(" \u6298\u6263\uFF1A- "+M(r.data.discount)+"% ",1)]),_:1})]),_:1})]),_:1})):B("",!0),i(ue,{class:"col-2"},{default:f(()=>[i(X,null,{default:f(()=>[i(se,null,{default:f(()=>[Y(M(r.info.status==="init"?"\u9884\u8BA1\u5F00\u64AD\uFF1A":"\u5F00\u64AD\u65F6\u95F4\uFF1A")+" "+M(Z($e).formatDate(Number(r.info.startTime),"H:mm")),1)]),_:1})]),_:1})]),_:1}),r.info.numberPeople>0?(p(),V(ue,{key:1,class:"col-2"},{default:f(()=>[i(X,null,{default:f(()=>[i(se,null,{default:f(()=>[Y(" \u62FC\u5355\u4EBA\u6570\uFF1A"+M(r.info.numberPeople)+" \u4EBA ",1)]),_:1})]),_:1})]),_:1})):B("",!0),r.info.completeness>0?(p(),V(ue,{key:2,class:"col-2"},{default:f(()=>[i(X,null,{default:f(()=>[i(se,null,{default:f(()=>[Y(" \u62FC\u5355\u5B8C\u6210\uFF1A"+M(r.info.completeness)+"% ",1)]),_:1})]),_:1})]),_:1})):B("",!0),r.info.myTotalPaid>0?(p(),V(ue,{key:3,class:"col-2"},{default:f(()=>[i(X,null,{default:f(()=>[i(se,null,{default:f(()=>[Y(" \u60A8\u5DF2\u652F\u4ED8\uFF1A"+M(r.info.myTotalPaid),1)]),_:1})]),_:1})]),_:1})):B("",!0)]}),_:1})]),_:1})):B("",!0)]))}});var Ka=Ge(Ya,[["__scopeId","data-v-320160b4"]]);const Ja={class:"row justify-between items-end q-mb-xs"},Wa={class:"col text-bold text-center"},Xa={class:"q-mr-sm",style:{"font-size":"12px"}},Za=ne({__name:"ShowsList",props:{fountain_id:{}},emits:["show"],setup(T,{emit:r}){const g=u(),S=u(),c=T,$=r;_e(async()=>{const z=await Je.getInstance().request("databaseCRUD/get",{query:{collection:"pcf-shows",condition:JSON.stringify({fountain_id:c.fountain_id})}});console.log("shows res:",z);const b=Fa(z.data);console.log("shows result:",b),g.value=b==null?void 0:b.shows,n(b?b.index:0)});function n(t){console.log("onSelectShow i:",t),S.value=t,$("show",g.value?g.value[t]:void 0)}return(t,z)=>(p(),x("div",null,[A("div",Ja,[A("div",Wa,M(Z($e).formatDate(Date.now(),"YYYY \u5E74 M \u6708 D \u65E5")),1),A("div",Xa,M(t.$t("weekdays").split(",")[Number(Z($e).formatDate(Date.now(),"E"))-1]),1)]),i(We,{class:"column col scroll_box"},{default:f(()=>[g.value?(p(),V(Ae,{key:0,separator:"",class:"column col"},{default:f(()=>[(p(!0),x(oe,null,ye(g.value,(b,y)=>(p(),V(ue,{key:y,class:"col-2",active:y==S.value,"active-class":"bg-yellow text-primary shadow-3",clickable:"",onClick:ie(w=>n(y),["stop"])},{default:f(()=>[i(X,null,{default:f(()=>[i(se,null,{default:f(()=>[Y(M(b.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["active","onClick"]))),128))]),_:1})):B("",!0)]),_:1})]))}});var el=Ge(Za,[["__scopeId","data-v-4bed9ece"]]);const al=[D("g",[D("path",{fill:"none",stroke:"currentColor","stroke-width":"5","stroke-miterlimit":"10",d:"M58.4,51.7c-0.9-0.9-1.4-2-1.4-2.3s0.5-0.4,1.4-1.4 C70.8,43.8,79.8,30.5,80,15.5H70H30H20c0.2,15,9.2,28.1,21.6,32.3c0.9,0.9,1.4,1.2,1.4,1.5s-0.5,1.6-1.4,2.5 C29.2,56.1,20.2,69.5,20,85.5h10h40h10C79.8,69.5,70.8,55.9,58.4,51.7z"}),D("clipPath",{id:"uil-hourglass-clip1"},[D("rect",{x:"15",y:"20",width:"70",height:"25"},[D("animate",{attributeName:"height",from:"25",to:"0",dur:"1s",repeatCount:"indefinite",values:"25;0;0",keyTimes:"0;0.5;1"}),D("animate",{attributeName:"y",from:"20",to:"45",dur:"1s",repeatCount:"indefinite",values:"20;45;45",keyTimes:"0;0.5;1"})])]),D("clipPath",{id:"uil-hourglass-clip2"},[D("rect",{x:"15",y:"55",width:"70",height:"25"},[D("animate",{attributeName:"height",from:"0",to:"25",dur:"1s",repeatCount:"indefinite",values:"0;25;25",keyTimes:"0;0.5;1"}),D("animate",{attributeName:"y",from:"80",to:"55",dur:"1s",repeatCount:"indefinite",values:"80;55;55",keyTimes:"0;0.5;1"})])]),D("path",{d:"M29,23c3.1,11.4,11.3,19.5,21,19.5S67.9,34.4,71,23H29z","clip-path":"url(#uil-hourglass-clip1)",fill:"currentColor"}),D("path",{d:"M71.6,78c-3-11.6-11.5-20-21.5-20s-18.5,8.4-21.5,20H71.6z","clip-path":"url(#uil-hourglass-clip2)",fill:"currentColor"}),D("animateTransform",{attributeName:"transform",type:"rotate",from:"0 50 50",to:"180 50 50",repeatCount:"indefinite",dur:"1s",values:"0 50 50;0 50 50;180 50 50",keyTimes:"0;0.7;1"})])];var ll=je({name:"QSpinnerHourglass",props:pa,setup(T){const{cSize:r,classes:g}=ha(T);return()=>D("svg",{class:g.value,width:r.value,height:r.value,viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",xmlns:"http://www.w3.org/2000/svg"},al)}});const tl={id:"auditionPlayer"},ol=["src"],ul={class:"q-mt-md row justify-between items-center"},sl={key:0,class:"q-mt-md row justify-between items-center"},fe=20,nl=ne({__name:"BaiduTTS",props:{tts_text:{},max_length:{default:35},disable_tts:{type:Boolean,default:!1},order_id:{},play_status:{default:-1}},emits:["update:tts_text","tts_info"],setup(T,{emit:r}){const g=ke(),{t:S}=Ce(),{locale:c}=Ce({useScope:"global"}),$=T,n=r,t=u(null),z=u(),b=u(""),y=u(!1),w=u(!0);let C=[],s=[];const _=u([]),k=u("");let F=[];const L=u([]),q=u(""),P=u(20);let H=0;const E=u(0),I=u(!1),Q=u(!1),ae=u(""),O=u("\u672C\u8282\u76EE\uFF0C\u7531\u81F4\u529B\u4E8E\u4E92\u52A8\u55B7\u6CC9\u7684\u6DF1\u5733\u793A\u8054\u79D1\u6280\u6709\u9650\u516C\u53F8\u8D5E\u52A9\u64AD\u51FA\u3002");let U=[],m;_e(async()=>{var h;g.localStorage.has("__QPCF_LOCAL_LOGIN_USER_INFO")&&(U=g.localStorage.getItem("__QPCF_LOCAL_LOGIN_USER_INFO")),console.log("onTryListen userInfo:",U);try{const v=await Fe.request("ttsBaidu/getVoiceListInfo",{query:{ttsProvider:"Azure",user_id:U[0].uid||""}});if(console.log("TTS getVoiceListInfo res:",v),v.errCode===0&&v.data){const{data:e}=v,l={};l[e.azureSubscriptionKeyHeader]=e.azureSpeechApiKey,za(e.azureVoicesListPath,{host:e.azureSpeechVoiceHost.replace("REGION",e.azureSpeechAppID),headers:l}).then(a=>{console.log("Azure return voice list:",a),a?(C=a,j(q.value)):console.log("Voices List is NULL")})}else v.errCode?(Q.value=!0,E.value=0,console.log("TTS err:",v.errMsg)):!v.success&&((h=v.error)==null?void 0:h.message)&&/resource exhausted/.test(v.error.message)&&console.warn("DB resource exhausted.")}catch(v){console.error("cloudObj FountainsList:",v)}}),Ye(()=>{t.value=document.getElementById("auditionPlayer")}),be(()=>{m&&clearTimeout(m)}),ee(()=>c.value,h=>{console.log("watch locale.value",h),F=S("manage_form.accents").split(","),console.log("watch accentsList:",F),L.value=S("manage_form.accents_local").split(","),console.log("watch accents.value:",L.value),q.value=L.value[0],C.length&&j(q.value)},{immediate:!0}),ee(()=>O.value,(h,v)=>{console.log("watch ttsText.value, n: %s, o: %s",h,v),n("update:tts_text",h),typeof h=="string"&&typeof v=="string"&&(h.length>=fe&&v.length<fe||h.length<fe&&v.length>=fe)&&pe(100).then(()=>{z.value&&z.value.focus()})},{immediate:!0}),ee(()=>[w.value,q.value],([h,v])=>{console.log("watch voiceGender: %s, accent: %s",h,v),C&&typeof v=="string"&&j(v)}),ee(()=>$.disable_tts,h=>{y.value=h},{immediate:!0});function j(h){_.value=[],s=[],k.value="";const v=w.value?"Male":"Female";for(const e of C)if(e.Gender===v&&!e.LocalName.includes("Multilingual")){const l=F[L.value.indexOf(h)];let a="",o="";c.value==="zh-CN"?l==="mandarin"?e.LocaleName==="Chinese (Mandarin, Simplified)"&&e.Locale.includes(c.value)&&e.LocalName!=="\u6653\u6653\u65B9\u8A00"&&(a=e.LocalName,o=e.ShortName):l==="guangdong"?(e.Locale.includes("zh-HK")||e.Locale.includes("yue-CN"))&&(a=e.LocalName,o=e.ShortName):["wuu-CN","zh-TW"].includes(l)?e.Locale.includes(l)&&(a=e.LocalName,o=e.ShortName):l==="shaanxi"?(e.Locale.includes(l)||e.LocalName.includes("\u6653\u6653\u65B9\u8A00"))&&(a=e.LocalName,o=e.ShortName):e.Locale.includes(l)&&e.Locale.includes(c.value)&&(a=e.LocalName,o=e.ShortName):c.value==="en-US"&&e.Locale.includes(l)&&(a=e.LocalName,o=e.ShortName),a&&o&&(_.value.push(a),s.push(o))}console.log("shortNames:",s),_.value.length&&(k.value=_.value[0])}async function N(){var h;if(E.value>0&&t.value)if(++E.value>2){t.value.play(),E.value=1;const v=H-t.value.played.end(0)*te;v>0&&J(v)}else clearTimeout(m),t.value.pause();else if(!Q.value)try{const v=_.value.findIndex(o=>o===k.value),e=w.value?"zh-CN-YunyangNeural":"zh-CN-XiaoxiaoNeural",l=v>=0?s[v]:e;console.log("voicePerson:",l),I.value=!0;const a=await Fe.request("ttsBaidu/textSynthesizeAudio",{query:{text:O.value,ttsProvider:"Azure",voice:l,order_id:"65a94cfa55b3372a1fc82b28",user_id:U[0].uid||""}});a.errCode===0?(P.value=a.remainCount,a.fileUrl?(b.value=a.fileUrl,H=a.duration,Q.value=!1,ae.value="",t.value&&(E.value=1,t.value.load(),t.value.play(),J(H),I.value=!1,n("tts_info",{url:b.value,duration:H,type:"audio/webm",player:t.value}))):(b.value="",Q.value=a.remainCount<1,E.value=0,ae.value=a.errMsg,I.value=!1),console.log("tryHint.value:",ae.value)):a.errCode?(Q.value=!0,E.value=0,console.log("TTS err:",a.errMsg)):!a.success&&((h=a.error)==null?void 0:h.message)&&/resource exhausted/.test(a.error.message)&&console.warn("DB resource exhausted.")}catch(v){console.error("cloudObj FountainsList:",v)}}function J(h){m=setTimeout(()=>{var v;E.value=0,console.log("player.value.ended:",(v=t.value)==null?void 0:v.ended),clearTimeout(m)},h+100)}return(h,v)=>(p(),x(oe,null,[A("audio",tl,[A("source",{src:b.value,type:"audio/webm"},null,8,ol),Y(" \u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301 audio \u6807\u7B7E\u3002 ")]),A("div",ul,[i(Ke,{class:"",label:`${w.value?h.$t("manage_form.male"):h.$t("manage_form.female")}`,modelValue:w.value,"onUpdate:modelValue":v[0]||(v[0]=e=>w.value=e),disable:Q.value||!O.value.length||y.value,"keep-color":"",color:w.value?"primary":"pink"},null,8,["label","modelValue","disable","color"]),i(he,{rounded:"",outline:"","no-caps":"",disable:Q.value||!O.value||y.value,label:h.$t("manage_form.trials"),color:Q.value||!O.value||y.value?"grey":"primary",loading:I.value,icon:Q.value||!O.value||y.value?Z(Ea):E.value<1?Z(qa):E.value===2?"play_arrow":"pause",onClick:ie(N,["stop"])},{loading:f(()=>[i(ll,{class:"on-center"})]),_:1},8,["disable","label","color","loading","icon"])]),O.value&&!Q.value&&!y.value?(p(),x("div",sl,[i(Ie,{class:"col-6 q-pr-sm",outlined:"",modelValue:q.value,"onUpdate:modelValue":v[1]||(v[1]=e=>q.value=e),options:L.value,dense:"","options-dense":!0,"hide-dropdown-icon":"",label:h.$t("manage_form.accent"),"stack-label":""},{append:f(()=>[i(re,{name:"location_on"})]),_:1},8,["modelValue","options","label"]),i(Ie,{class:"col-6 q-pl-sm",outlined:"",modelValue:k.value,"onUpdate:modelValue":v[2]||(v[2]=e=>k.value=e),options:_.value,dense:"","options-dense":!0,"hide-dropdown-icon":"",label:h.$t("manage_form.voice"),"stack-label":""},{append:f(()=>[i(re,{name:"record_voice_over"})]),_:1},8,["modelValue","options","label"])])):B("",!0),i(Z(de),{ref_key:"textInput",ref:z,class:"q-my-md",modelValue:O.value,"onUpdate:modelValue":[v[3]||(v[3]=e=>O.value=e),v[5]||(v[5]=e=>h.$emit("update:tts_text",e))],debounce:"300",dense:"",outlined:"",autofocus:"",clearable:"",maxlength:h.max_length,disable:y.value||Q.value,type:O.value.length>=fe?"textarea":"text",label:`${h.$t("manage_form.input_message")}\uFF1A`,hint:y.value?"":`${h.$t("manage_form.remain")} ${h.max_length-O.value.length} ${h.$t("manage_form.words")}\u3002 ${h.$t("manage_form.remain")} ${P.value} ${h.$t("manage_form.count")}${h.$t("manage_form.trials")}\u3002`,"lazy-rules":"",rules:[e=>e.length>=0||"\u7559\u8A00\u7684\u957F\u5EA6"],onClear:v[4]||(v[4]=e=>O.value="")},null,8,["modelValue","maxlength","disable","type","label","hint","rules"])],64))}}),il={key:0,class:"q-mb-md",style:{border:"1px solid lightgrey",borderRadius:"5px"}},rl={key:0,class:"q-pa-sm row"},cl={class:"col-4"},dl={class:"col-8"},vl={class:"q-pa-none row"},fl={class:"col-7"},ml={class:"col-5"},pl={class:"q-mt-xs q-pl-md row justify-between"},hl={key:0,class:"q-mb-md"},gl={key:0,class:"row flex-center"},yl=["poster"],_l=["src","type"],bl={key:1,class:"row flex-center"},Sl={id:"audioPlayer",class:"",controls:""},Tl=["src","type"],wl={key:2,class:"row flex-center"},zl={key:3,class:"q-pa-sm"},$l={class:"q-ma-sm"},Fl={class:"row"},Cl={class:"row"},kl={key:0,class:"row justify-between"},Oe=.16,Pl=ne({__name:"MediaCombo",props:{index:{default:-1},list:{},ffplay:{type:Boolean,default:!1},max_duration:{default:10*te},max_filesize:{default:1e7},select_time:{type:Boolean,default:!1},tts_player:{default:null}},emits:["update:index"],setup(T,{emit:r}){const g=T,S=r,c=u(0);let $;const n=u();let t=0;const z=u(""),b=u(100),y=u(""),w=u(""),C=u(""),s=u({active:[],av:[],types:[],duration:0,startTime:"",files:[null,null]});be(()=>{$&&clearTimeout($)}),ee(()=>g.tts_player,e=>{const l=s.value.types.indexOf("tts");if(e)l>-1?s.value.active[l]=e:(s.value.active.push(e),s.value.types.push("tts"));else{const a=s.value.types.indexOf("tts");a>-1&&(s.value.active[a]=null)}m(),P()},{immediate:!0}),ee(()=>g.index,e=>{t=e,e>-1&&g.list&&(n.value=g.list[e])},{immediate:!0}),ee(()=>s.value.startTime,e=>{let l=0;if(e&&(l=_(e)),l>-1){z.value="";let a=s.value.duration-l*te;a<0&&(a=s.value.duration,l=0,z.value="\u8D85\u51FA\u65F6\u957F"),s.value.active.forEach(o=>{if(o)if(o.ended){const d=o.duration;console.log("watch startTime d:",d),l<d?(o.load(),o.currentTime=l,c.value===1&&o.play()):o.currentTime=d}else o.currentTime=l}),c.value===1&&(clearTimeout($),h(a))}else z.value="59 , 2:59 , 1:59:59"});function _(e){const l=e.includes(" ")?e.replace(/\s/g,""):e;return/^\d{1,2}:\d{1,2}:\d{1,2}$/.test(l)||/^\d{1,2}:\d{1,2}$/.test(l)||/^[1-5]?[0-9]$/.test(l)?Ca(l):-1}function k(e){var l;console.log("onParamsFocus i:",e),t>=0&&((l=g.list)==null?void 0:l.length)&&(t=e,n.value=g.list[e],S("update:index",e),w.value=n.value.url)}function F(e){var l;console.log("onParamsBlur i:",e),console.log("onParamsBlur props.list:",g.list),e>=0&&((l=g.list)==null?void 0:l.length)&&console.log(`onParamsBlur props.list[${e}]:`,g.list[e])}function L(){c.value===1&&N()}function q(){if(n.value){console.log("onCloseMediaFile mediaParams.value:",n.value),n.value.file&&(n.value.file=null),n.value.url="";const l=n.value.type.split("/")[0];if(l==="audio"||l==="video"){const a=s.value.types.indexOf(l);s.value.av.length===1&&(clearTimeout($),c.value=0),s.value.active[a]=null;let o=0;for(const d of s.value.av){if((d instanceof HTMLAudioElement?"audio":"video")===l){s.value.av.splice(o,1);break}o++}l==="video"&&(y.value="")}else y.value="",C.value="";m(),P()}}function P(){let e=0;if(s.value.active.length){let a=0;for(const o of s.value.active)o&&(H(a),o.duration>e&&(e=o.duration)),a++}e*=te;const l=e>g.max_duration?g.max_duration:e;s.value.duration=Math.round(l)}function H(e){if(g.list&&s.value.types.length){const l=s.value.types[e],a=g.list.find(d=>d.type.includes(l)),o=s.value.active[e];if(a&&o&&g.max_duration){const R=` -t ${o.duration*te>g.max_duration?Math.round(g.max_duration/10)/100:Math.round(o.duration*100)/100}`,W=/\-t\s+\d+\.?\d*/;W.test(a.ffplay)?a.ffplay=a.ffplay.replace(W,R):a.ffplay+=R}}}async function E(){if(n.value){const{url:e,type:l}=n.value;if(e&&e.length>7&&e!==w.value&&(w.value=e,!e.includes("blob:http")&&e.includes("http"))){const a=e.split("/").pop();if(typeof a=="string"){const o=l.split("/")[0],d=a==null?void 0:a.split(".").pop(),R=Q(o,d);n.value.type=`${o}/${R}`,n.value.name=a,n.value.file=null,await I(o,e)}}}}async function I(e,l){if(n.value)if(e==="audio"||e==="video"){n.value.url&&(n.value.url="",await pe(100)),n.value.url=l,await pe(100),e==="video"&&(y.value="");let a=-1;s.value.types.length&&(a=s.value.types.indexOf(e)),O(e,a)}else n.value.url=l,y.value="",C.value=l,c.value>=1&&N()}function Q(e,l){if(!l)return"";let a=l;return e==="audio"&&(l==="m4a"?a="x-m4a":l==="weba"?a="webm":l==="mp3"?a="mpeg":a="webm"),a}async function ae(e){if(console.log("onMediaFilePicked file.type:",e.type),e&&n.value){const l=URL.createObjectURL(e);if(n.value.url!==l){n.value.name=e.name,n.value.type=e.type;const a=e.type.split("/")[0];await I(a,l)}}}function O(e,l){let a=0,o=e==="audio"?document.getElementById(`${e}Player`):document.getElementById(`${e}Player`);o&&(a=U(),l>-1?s.value.active[l]=o:(s.value.active.push(o),s.value.types.push(e)),s.value.av.push(o),a>0?(o.load(),o.currentTime=a):o.load(),N(),m())}function U(){let e=0;if(c.value>0){for(const l of s.value.active)if(l&&!l.ended){const a=c.value===1?l.played.end(0):l.currentTime;a>e&&(e=a)}}return e}function m(){s.value.av.length&&(g.tts_player?s.value.av.forEach(e=>{e&&(s.value.av.length===1?e.volume=Oe:e.volume=e instanceof HTMLAudioElement?Oe:0)}):s.value.av.forEach(e=>{e&&(s.value.av.length===2?e.volume=e instanceof HTMLAudioElement?1:0:e.volume=1)}))}function j(){let e=0;if([1,3].includes(c.value))for(const l of s.value.av)l&&!l.ended&&e<l.currentTime&&(e=l.currentTime);return e}function N(){s.value.active.length>0&&J(s.value.active)}function J(e){if(++c.value===2)clearTimeout($),e.forEach(l=>{l&&(l.pause(),console.log("playPauseTimeout element.currentTime:",l.currentTime))});else if(s.value.av.length){let l=j();c.value===3&&(c.value=1),e.forEach(async a=>{a&&a&&!a.ended&&a.play()}),pe(100).then(()=>{P(),h(s.value.duration-l*te)})}}function h(e){$=setTimeout(()=>{v(),b.value&&b.value--},e+80)}function v(){clearTimeout($);let e=0;if(s.value.startTime.length){const l=_(s.value.startTime);l>-1&&(e=l)}s.value.active.length&&s.value.active.forEach(async l=>{if(l){let a=e;if(a*te>s.value.duration&&(a=0),console.log("onPlayerStop st:",a),l.ended){const o=l.duration;a<o?(console.log("onPlayerStop d:",o),l.load()):a=o}else l.pause(),l.load();l.currentTime=a}}),c.value=0}return(e,l)=>e.list&&e.list.length>0?(p(),x("div",il,[s.value.av.length?(p(),x("div",rl,[A("div",cl,[i(de,{class:"q-pa-none q-pr-md",outlined:"",dense:"",clearable:"",disable:"",label:`${e.$t("manage_form.duration")}`,hint:s.value.duration<e.max_duration?`${e.$t("manage_form.max")}\uFF1A${Z(ze)(e.max_duration)}`:"","model-value":Z(ze)(s.value.duration)},null,8,["label","hint","model-value"])]),A("div",dl,[A("div",vl,[A("div",fl,[e.select_time?B("",!0):(p(),V(de,{key:0,class:"",label:`${e.$t("manage_form.start")}${e.$t("manage_form.time")}`,hint:z.value,outlined:"",dense:"",clearable:"",modelValue:s.value.startTime,"onUpdate:modelValue":l[0]||(l[0]=a=>s.value.startTime=a),"lazy-rules":"",rules:[a=>a.length>=0||"Time format, 12, 1:23, or 1:23:45"],onClear:l[1]||(l[1]=a=>s.value.startTime="")},null,8,["label","hint","modelValue","rules"]))]),A("div",ml,[A("div",pl,[i(he,{color:"primary",icon:c.value===1?"pause":"play_arrow",dense:"",outline:"",round:"",onClick:N},null,8,["icon"]),i(he,{dense:"",outline:"",color:"primary",icon:"stop",round:"",onClick:v})])])])])])):B("",!0),(p(!0),x(oe,null,ye(e.list,(a,o)=>(p(),x(oe,{key:o},[a.url?(p(),x("div",hl,[a.type.includes("video")?(p(),x("div",gl,[A("video",{id:"videoPlayer",width:"100%",height:"auto",poster:C.value,controls:""},[A("source",{src:a.url,type:a.type},null,8,_l),Y(" \u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301 video \u6807\u7B7E\u3002 ")],8,yl)])):a.type.includes("audio")?(p(),x("div",bl,[A("audio",Sl,[A("source",{src:a.url,type:a.type},null,8,Tl),Y(" \u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301 audio \u6807\u7B7E\u3002 ")])])):a.type.includes("image")?(p(),x("div",wl,[i(La,{src:a.url},null,8,["src"])])):(p(),x("div",zl," \u60A8\u52A0\u8F7D\u7684\u6587\u4EF6\u4E0D\u662F\u5A92\u4F53\u6587\u4EF6\u7C7B\u578B (audio, video, image) "))])):B("",!0),A("div",$l,[ce(A("div",Fl,[i(de,{class:"col-11 q-pa-none q-py-sm q-pr-sm",modelValue:a.url,"onUpdate:modelValue":[d=>a.url=d,l[2]||(l[2]=d=>E())],outlined:"",dense:"","lazy-rules":"",label:`${e.$t(`manage_form.${a.type.split("/")[0]}`)}${e.$t("manage_form.url")}`,disable:a.type.includes("video")&&!["video",""].includes(y.value)||a.type.includes("image")&&!["image",""].includes(y.value),rules:[d=>d.length>=0||"Please type something"],type:"url",onFocus:d=>k(o),onBlur:d=>F(o)},{append:f(()=>[a.url?(p(),V(re,{key:0,name:Z(Le),color:"grey-5",onClick:ie(q,["stop","prevent"])},null,8,["name"])):B("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","label","disable","rules","onFocus","onBlur"]),i(re,{name:"link",size:"sm",class:"col-1",color:"primary",onClick:ie(d=>a.from_url=!1,["stop","prevent"])},null,8,["onClick"])],512),[[we,a.from_url]]),ce(A("div",Cl,[i(Z(xa),{class:"col-11 q-py-sm q-pr-sm",modelValue:a.file,"onUpdate:modelValue":[d=>a.file=d,ae],outlined:"",dense:"",onFocus:d=>k(o),accept:a.type.includes("video")?"video/*":a.type.includes("audio")?"audio/*":"image/*",disable:a.type.includes("video")&&!["video",""].includes(y.value)||a.type.includes("image")&&!["image",""].includes(y.value),label:`${e.$t(`manage_form.${a.type.split("/")[0]}`)}${e.$t("manage_form.file")}`,onClick:L},{append:f(()=>[a.file?(p(),V(re,{key:0,name:Z(Le),color:"grey-5",onClick:ie(q,["stop","prevent"]),class:"cursor-pointer"},null,8,["name"])):B("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","onFocus","accept","disable","label"]),i(re,{name:"folder_open",size:"sm",class:"col-1",color:"primary",onClick:ie(d=>a.from_url=!0,["stop","prevent"])},null,8,["onClick"])],512),[[we,!a.from_url]]),e.ffplay?(p(),x("div",kl,[i(de,{class:"col-6 q-pa-none q-py-sm q-pr-sm",label:"ffplay",outlined:"",clearable:"",modelValue:a.ffplay,"onUpdate:modelValue":d=>a.ffplay=d,onFocus:d=>k(o),onBlur:d=>F(o),dense:"","lazy-rules":"",rules:[d=>d.length>=0||`ffplay ${e.$t("options")}: -t 30`]},null,8,["modelValue","onUpdate:modelValue","onFocus","onBlur","rules"]),i(de,{class:"col-6 q-pa-none q-py-sm q-pl-sm",label:"ffmpeg",type:"number",modelValue:a.ffmpeg,"onUpdate:modelValue":d=>a.ffmpeg=d,modelModifiers:{number:!0},clearable:"",onFocus:d=>k(o),onBlur:d=>F(o),dense:"","lazy-rules":"",outlined:"",rules:[d=>d>=0||"ffmpeg options: "]},null,8,["modelValue","onUpdate:modelValue","onFocus","onBlur","rules"])])):B("",!0)]),e.list&&o<e.list.length-1?(p(),V(ga,{key:1,class:"q-mb-sm"})):B("",!0)],64))),128))])):B("",!0)}}),Al={class:"row q-col-gutter-x-sm"},El={key:1},ql=A("div",{class:"q-mt-lg q-pl-xs text-purple"}," \u4EE5\u4E0B\u7559\u8A00\u5C06\u5728\u672C\u8282\u76EE\u73B0\u573A\u64AD\u51FA\u65F6\u7684\u8BED\u97F3\u62A5\u5E55\u4E2D\u64AD\u653E\u3002 ",-1),Ll={class:"q-my-lg row justify-between"},Ve=200,xl=ne({__name:"BookingBox",props:{program:{}},setup(T){const r=T,g=ke(),{locale:S}=Ce({useScope:"global"}),c=u("submit"),$=u(Ve*te),n=u(45),t=u(10*1024*1024),z=u(null),b=u(0),y=u(0),w=u(0),C=u(0),s=u(!1),_=u(""),k=u("\u8282\u76EE\u8BA2\u5355\u5DF2\u5B8C\u6210\u3002\u7559\u8A00\u9700\u8981\u53E6\u5916\u4ED8\u8D39\uFF0C\u4E0D\u80FD\u62FC\u5355\u3002"),F=u(!1),L=u("\u6C34\u6EF4");let q,P,H;const E=u(),I=u(),Q=u(!1),ae=u(-1),O={url:"",type:"",name:"",duration:0,ffplay:"",ffmpeg:"",fs_id:0,file:null,from_url:!1},U=u([]),m=u(-1);let j;_e(async()=>{g.sessionStorage.has("__QPCF_SESSION_LOGIN_USER_DATA")?(H=g.sessionStorage.getItem("__QPCF_SESSION_LOGIN_USER_DATA"),console.log("userData is in sessionStorage:",H)):console.log("userData is not in sessionStorage:",H),await v()}),be(()=>{clearInterval(j)}),ee(()=>S.value,o=>{o==="zh-CN"?n.value=45:o==="en-US"?n.value=150:n.value=100},{immediate:!0}),ee(()=>{var o;return(o=I.value)==null?void 0:o.startTime},o=>{console.log("watch info.value.startTime:",o),U.value.length===0&&U.value.push({...O,type:"audio/*"}),I.value&&ka(o)==="Night"?U.value.length<3&&(U.value.unshift({...O,type:"video/*"}),U.value.push({...O,type:"image/*"})):U.value.length===3&&(U.value.shift(),U.value.pop()),m.value=0},{immediate:!0});function N(o){console.log("onTtsInfo ttsInfo:",o),$.value=o.duration>$.value?o.duration:Ve*te,z.value=o.player}function J(){}async function h(o){var d;(o==null?void 0:o._id)!==((d=E.value)==null?void 0:d._id)&&(E.value=o),await v()}async function v(o){var d,R,W;if(E.value&&r.program){const K={program_id:r.program._id,show_id:E.value._id,show_date:E.value.showDate,end:E.value.endTime},ve=o?{...K,...o}:K;console.log("order:",ve);const le=await Fe.request(`placeOrder/${o?"add":"info"}`,{query:{order:JSON.stringify(ve),token:H.token[H.token.length-1],show_type:E.value.type,program_type:r.program.type,show_start:E.value.startTime,name_duration:((d=r.program)==null?void 0:d.name_duration)||0,amount:r.program.price*(100-E.value.discount)/100}});return console.log("getProgramOrder info res:",le),le.code===200&&le.data?(I.value=le.data,y.value=(R=I.value)==null?void 0:R.unpaid,w.value=(W=I.value)==null?void 0:W.unpaid,y.value>0?(b.value=y.value,b.value<C.value&&(C.value=b.value)):I.value&&E.value&&(console.log("getProgramOrder info.value:",I.value),console.log("getProgramOrder show.value:",E.value),!I.value.situation&&I.value.status==="ready"&&I.value.completeness===100?(b.value=E.value.message_price,w.value=b.value,C.value=b.value,F.value=!1):(b.value=0,w.value=0,C.value=0,F.value=!0))):g.notify({type:"warning",message:"\u670D\u52A1\u5668\u8FD4\u56DE\u7684\u6570\u636E\u9519\u8BEF",caption:le.errMsg,multiLine:!0,position:"top"}),le}}function e(o){var d,R;console.log("onPaid payment:",o),o>0&&(a(2e4),g.notify({message:`\u652F\u4ED8 ${o} ${L.value}`,caption:`\u9884\u8BA2\u300A${(R=(d=r.program)==null?void 0:d.media)==null?void 0:R.name}\u300B`,multiLine:!0,position:"center",icon:"paid",timeout:2e4,color:"purple",actions:[{label:"\u653E\u5F03",color:"white",handler:()=>{console.log("\u7528\u6237\u653E\u5F03\u9884\u8BA2"),clearTimeout(P),s.value=!1}},{label:"\u786E\u8BA4",color:"yellow",handler:()=>{q=!0,q&&l(o)}}]}))}function l(o){var W,K,ve;const d=Date.now(),R={fountain_id:((W=r.program)==null?void 0:W.fountain_id)||"",start:0,duration:((ve=(K=r.program)==null?void 0:K.media)==null?void 0:ve.duration)||0,paid:o,forecast_count:1,created_at:d,updated_at:d};console.log("orderAdd:",R),v(R).then(le=>{var Ee;le.code===200&&(clearTimeout(P),s.value=!1,le.data.balance,g.notify({message:le.data.notice,caption:(Ee=r.program)==null?void 0:Ee.name,multiLine:!0,icon:"check_circle",position:"bottom",color:"positive"}))})}function a(o){P&&clearTimeout(P),s.value=!0,P=setTimeout(()=>{clearTimeout(P),s.value=!1},o)}return(o,d)=>{var R,W;return p(),x("div",null,[A("div",Al,[i(Ka,{class:"col",data:E.value,info:I.value},null,8,["data","info"]),i(el,{class:"col",fountain_id:(R=o.program)==null?void 0:R.fountain_id,onShow:h},null,8,["fountain_id"])]),w.value>0?(p(),V(Aa,{key:0,class:"q-mt-lg",pay:b.value,"onUpdate:pay":d[0]||(d[0]=K=>b.value=K),min_pay:C.value,max_pay:w.value,label:k.value,title:"\u652F\u4ED8",unit:L.value,disable:s.value,slider:C.value<w.value,onPaid:e},null,8,["pay","min_pay","max_pay","label","unit","disable","slider"])):B("",!0),y.value===0?(p(),x("div",El,[ql,i(nl,{tts_text:_.value,"onUpdate:tts_text":d[1]||(d[1]=K=>_.value=K),order_id:(W=I.value)==null?void 0:W._id,max_length:n.value,disable_tts:F.value,play_status:ae.value,onTts_info:N},null,8,["tts_text","order_id","max_length","disable_tts","play_status"]),F.value?B("",!0):(p(),x(oe,{key:0},[A("div",Ll,[i(Ke,{class:"",label:o.$t("manage_form.media_materials"),modelValue:Q.value,"onUpdate:modelValue":d[2]||(d[2]=K=>Q.value=K),color:"primary"},null,8,["label","modelValue"]),i(he,{class:"q-px-md",outline:"","no-caps":"",unelevated:"",label:o.$t(`manage_form.${c.value}`),type:"submit",color:"positive",icon:"cloud_upload",rounded:"",onClick:J},null,8,["label"])]),ce(A("div",null,[i(Pl,{class:"q-mt-sm",list:U.value,index:m.value,"onUpdate:index":d[3]||(d[3]=K=>m.value=K),max_duration:$.value,max_filesize:t.value,tts_player:z.value},null,8,["list","index","max_duration","max_filesize","tts_player"])],512),[[we,Q.value]])],64))])):B("",!0)])}}}),gt=ne({__name:"Tab1Page",setup(T){const r=Ba(),g=u(!1),S=ke(),c=ya(),$=_a(),n=u(Date.now()),t=u(1),z=u(!1),b=u(),y=u(0),w=u([]),C=u(),s=u(),_=u(!1),k=u(),F=u(),L=u(),q=u(),P=G(()=>{var j,N,J,h;let m=((j=k.value)==null?void 0:j.clientHeight)||0;return m+=((N=F.value)==null?void 0:N.clientHeight)||0,m+=((J=L.value)==null?void 0:J.clientHeight)||0,m+=((h=q.value)==null?void 0:h.clientHeight)||0,{paddingTop:m+"px"}}),H=G(()=>{let m="\u9009\u55B7\u6CC9";return z.value&&_.value?m="\u9009\u573A\u6B21\u3001\u652F\u4ED8":z.value&&(m="\u9009\u8282\u76EE"),m});let E;_e(async()=>{if(S.sessionStorage.has("__QPCF_TAB1_PAGE_STATUS")){const m=S.sessionStorage.getItem("__QPCF_TAB1_PAGE_STATUS");b.value=m.fountain,C.value=m.program,w.value=m.programTabs,s.value=m.programType,t.value=m.step,z.value=m.isFountain,_.value=m.isProgram,y.value=m.currentTab,g.value=m.isSearchBar}await $a()&&$.push({path:"/login",query:{display:"banner",lastPath:c.path}})}),Ye(()=>{E=setInterval(()=>{n.value=Date.now()},te)}),Re(()=>{console.log("Tab1 onActivated()")}),ba(()=>{if(S.sessionStorage.has("__QPCF_SESSION_LOGIN_MESSAGE")){const m=S.sessionStorage.getItem("__QPCF_SESSION_LOGIN_MESSAGE");console.log("Tab1 __QPCF_SESSION_LOGIN_MESSAGE message: ",m),S.sessionStorage.remove("__QPCF_SESSION_LOGIN_MESSAGE"),S.notify({message:m,caption:"1wW seconds ago",color:"secondary"})}}),be(()=>{clearInterval(E),S.sessionStorage.set("__QPCF_TAB1_PAGE_STATUS",{step:t.value,isFountain:z.value,isProgram:_.value,currentTab:y.value,fountain:b.value,program:C.value,programTabs:w.value,programType:s.value,isSearchBar:g.value}),console.log("Tab1 onUnmounted()")});function I(){z.value=!1,t.value=1}function Q(m){var j;if(m){if(r.setKey(""),b.value&&b.value._id===m._id)t.value=_.value&&C.value?3:2;else{if(b.value=m,(j=m.program_types)!=null&&j.length){for(;w.value.length>0;)w.value.pop();w.value.push(...m.program_types)}t.value=2}z.value=!0}}function ae(){_.value=!1,t.value=2,r.isEnable||r.toggleEnable()}async function O(m){m&&(C.value=m,m.type&&w.value.includes(m.type)&&(s.value=m.type,U(),_.value=!0,t.value=3))}function U(){r.setKey(""),r.isShow&&r.toggleShow(),r.isEnable&&r.toggleEnable()}return(m,j)=>(p(),V(oa,{style:Sa(P.value)},{default:f(()=>[z.value?(p(),x(oe,{key:0},[_.value&&s.value?(p(),V(xl,{key:0,program:C.value,class:"q-ma-md"},null,8,["program"])):(p(),x(oe,{key:1},[b.value?(p(),V(Qa,{key:0,type:w.value[y.value],typeIndex:y.value,search:Z(r).key,typesLength:w.value.length,fountainId:b.value._id,onSelected:O},null,8,["type","typeIndex","search","typesLength","fountainId"])):B("",!0)],64))],64)):(p(),V(ua,{key:1,onSelected:Q})),i(ta,{expand:"",position:"top"},{default:f(()=>[i(la,{class:Pe(["q-px-none shadow-8",Z(S).dark.isActive?"bg-grey-10":"bg-grey-2"])},{default:f(()=>[i(aa,{class:"text-subtitle1 text-center"},{default:f(()=>[A("div",{ref_key:"step_bar",ref:k,class:"row items-center justify-center"},[i(Xe,{class:"q-my-sm",ripple:!1,outline:"",color:Z(S).dark.isActive?"purple-3":"purple"},{default:f(()=>[Y(" \u7B2C "+M(t.value)+" \u6B65\uFF1A"+M(H.value),1)]),_:1},8,["color"])],512),z.value?(p(),x(oe,{key:0},[A("div",{ref_key:"fn_card",ref:F},[i(sa,{data:b.value,onClick:I},null,8,["data"])],512),_.value&&s.value?(p(),x("div",{key:0,ref_key:"pr_card",ref:L},[i(Ha,{data:C.value,onClick:ae},null,8,["data"])],512)):(p(),x("div",{key:1,ref_key:"pr_tabs",ref:q},[w.value.length?(p(),V(ea,{key:0,modelValue:y.value,"onUpdate:modelValue":j[0]||(j[0]=N=>y.value=N),dense:"","inline-label":"",class:"col text-purple-3","active-color":"purple"},{default:f(()=>[(p(!0),x(oe,null,ye(w.value,(N,J)=>(p(),V(Ze,{class:"col",key:J,name:J,label:N},null,8,["name","label"]))),128))]),_:1},8,["modelValue"])):B("",!0)],512))],64)):B("",!0)]),_:1})]),_:1},8,["class"])]),_:1})]),_:1},8,["style"]))}});export{gt as default};
