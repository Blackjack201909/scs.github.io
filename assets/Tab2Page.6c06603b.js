import{Q as W}from"./QToolbarTitle.5e2b8a84.js";import{Q as G}from"./QToolbar.582a7924.js";import{_ as H,d as J,u as V,k as K,r as n,l as X,a as Y,o as Z,c as uu,w as q,m as F,n as v,p as s,j as r,q as C,x as P,y as w,A as T,B as _,t as l,F as S,s as c,Q as eu}from"./index.4f390c6a.js";import{Q as N}from"./QItemLabel.95b24a48.js";import{Q as au}from"./QExpansionItem.912b4e2a.js";import{Q as tu}from"./QList.423862dd.js";import{Q as su}from"./QPage.e32daf6c.js";import{S as D,d as ou}from"./constant.a3c7e21e.js";import{U as nu,a as ru}from"./cloudDB.d318324a.js";import{u as lu}from"./use-quasar.4e14d354.js";import"./axios.ea5872bc.js";const cu={class:"q-ma-md"},iu={class:"q-py-lg"},Fu={class:"prompt_box q-ma-md q-py-sm"},du={class:"q-ma-md"},Eu=J({__name:"Tab2Page",setup(Cu){const O=lu(),R=V(),p=K(),d=n(navigator.onLine),E=n(""),i=n(2e5),h=n(!1);let U;const f=n(0),g=n(0),b=n(0),x=n(0),k=n(0),y=n(""),t=n([{checkbox:"\u2714\uFE0F",name:"\u4E92\u52A8\u8BA2\u5355\uFF1A",status:"\u6709",details:"\u4E2D\u7EA7\u4E92\u52A8\u55B7\u6CC9"},{checkbox:"\u274C",name:"\u7535\u6C60\u7535\u91CF\uFF1A",status:"\u5145\u8DB3",details:"\u4F4E\u4E8E 10%\uFF0C\u9700\u53CA\u65F6\u5145\u7535\u3002"},{checkbox:"",name:"\u7F51\u7EDC\u8FDE\u63A5\uFF1A",status:d.value?"\u6B63\u5E38":"\u65AD\u5F00",details:"\u53EF\u4EE5\u4E0E\u55B7\u6CC9\u8FDB\u884C\u4E92\u52A8\u64CD\u4F5C"},{checkbox:"\u274C",name:"\u6240\u5904\u4F4D\u7F6E\uFF1A",status:"\u55B7\u6CC9\u73B0\u573A",details:"\u8DDD\u79BB\u55B7\u6CC9 100 \u7C73"}]);let I;X(async()=>{await j(),I=setInterval(async()=>{d.value=navigator.onLine,i.value>=D&&(i.value-=D,i.value<=0&&(h.value=!0,i.value=0,M()))},D)}),Y(()=>{clearInterval(I)}),Z(()=>{navigator.permissions.query({name:"geolocation"}).then(u=>{y.value=u.state,console.log("navigator.permissions geolocation",u.state)}).catch(u=>{console.error(u)}),navigator.geolocation.watchPosition(u=>{f.value=u.coords.latitude,g.value=u.coords.longitude,b.value=113.88331750753362,x.value=22.930527922471946;const o=6371,a=113.85709109681925,e=22.92457016144945,Q=b.value,z=x.value,B=(Q-a)*Math.PI/180,A=(z-e)*Math.PI/180,m=Math.sin(B/2)*Math.sin(B/2)+Math.cos(a*Math.PI/180)*Math.cos(Q*Math.PI/180)*Math.sin(A/2)*Math.sin(A/2),L=2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m));k.value=o*L,console.log("dLat: %s, dLng: %s",B,A),console.log("a: %s, c: %s",m,L)},u=>{console.error(u)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})});const $=uu(()=>{const u=t.value.findIndex(a=>a.checkbox==="\u274C"),o=u<0?["\u8BF7\u63D0\u524D\u5230\u8FBE\u55B7\u6CC9\u73B0\u573A\u3002","\u5F53\u542C\u5230\u55B7\u6CC9\u73B0\u573A\u7684\u5E7F\u64AD\u63D0\u793A\u540E\uFF0C\u5C3D\u5FEB\u8FDB\u5165\u672C\u9875\u9762\u3002\u7B49\u63D0\u793A\u6846\u51FA\u73B0\u65F6\uFF0C\u6309\u4E0B\u3010\u786E\u8BA4\u3011\u6309\u94AE\u5F00\u59CB\u4E92\u52A8\u3002","\u{1F975} \u5982\u679C\u60A8\u56E0\u6545\u672A\u5230\uFF0C\u55B7\u6CC9\u5C06\u5F00\u542F\u81EA\u52A8\u64AD\u653E\u6A21\u5F0F\u3002","\u53EA\u8981\u60A8\u5728\u8282\u76EE\u7ED3\u675F\u4E4B\u524D\u8D76\u5230\uFF0C\u70B9\u51FB\u3010\u786E\u8BA4\u3011\uFF0C\u4ECD\u7136\u53EF\u4EE5\u7EE7\u7EED\u4E92\u52A8\u3002\u{1F929}"]:["\u60A8\u65E0\u6CD5\u8FDB\u884C\u4E92\u52A8\u8282\u76EE\u3002","\u8BF7\u68C0\u67E5\u6253 \u274C \u7684\u9879\u76EE\uFF0C\u67E5\u627E\u539F\u56E0\u3002"];if(u>=0)switch(u){case 0:o.push("\u60A8\u5C1A\u672A\u9884\u8BA2\u4E92\u52A8\u8282\u76EE\uFF0C\u8BF7\u6309\u4E0A\u9762\u7684\u7EFF\u8272\u6309\u94AE\u9884\u8BA2\u3002");break;case 1:o.push("\u60A8\u7684\u8BBE\u5907\u7535\u91CF\u8FC7\u4F4E\uFF0C\u65E0\u6CD5\u5B8C\u6210\u4E92\u52A8\u64CD\u4F5C\u3002");break;case 2:o.push("\u60A8\u7684\u8BBE\u5907\u5DF2\u7ECF\u65AD\u7F51\uFF0C\u65E0\u6CD5\u8FDB\u884C\u4E92\u52A8\u64CD\u4F5C\u3002");break;case 3:o.push("\u60A8\u7684\u8BBE\u5907\u8DDD\u79BB\u55B7\u6CC9\u592A\u8FDC\uFF0C\u65E0\u6CD5\u770B\u5230\u4E92\u52A8\u7684\u6548\u679C\uFF0C\u8BF7\u5C3D\u5FEB\u5230\u8FBE\u73B0\u573A\u3002");break}return o});q(()=>i.value,u=>{u>0?h.value&&(E.value="\u6B63\u5728\u8FDE\u63A5\u55B7\u6CC9\u3002\u3002\u3002"):E.value=t.value[0].checkbox==="\u2714\uFE0F"?`\u8DDD\u4E92\u52A8\u5F00\u59CB\u8FD8\u6709 ${ou(u)}`:"\u70B9\u64AD\u4E00\u4E2A\u4E92\u52A8\u8282\u76EE"},{immediate:!0,deep:!0}),q(()=>d.value,u=>{console.log("watch online:",d.value),t.value[2].checkbox=u?"\u2714\uFE0F":"\u274C",t.value[2].status=u?"\u6B63\u5E38":"\u65AD\u5F00",t.value[2].details=u?"\u7F51\u7EDC\u8FDE\u63A5\u6B63\u5E38\u3002\u8BF7\u4FDD\u6301\u3002":"\u8BF7\u68C0\u67E5\u7F51\u7EDC\uFF0C\u5E76\u5C3D\u5FEB\u8FDE\u63A5"},{immediate:!0,deep:!0});async function j(){var a;const u=nu.getInstance();await ru()&&p.push({path:"/login",query:{display:"banner",lastPath:R.path}});const o=O.localStorage.getItem("__QPCF_LOCAL_LOGIN_USER_INFO")[0];try{const e=await u.request("getDetails/programsPage",{query:{collection:"pcf-programs",condition:JSON.stringify({where:'type == "\u4E92\u52A8"',skip:0,limit:100,orderBy:"order asc",ordersWhere:`show_id=='62c90505996ab200018eb37e'
           && show_date== 1681920000000 && in(status, [1, 2, 3])`,ordersField:"_id, program_id, user_id, max(start) as startTime, max(end) as endTime, duration",mediaField:"_id, name",outWhere:"size(_id.orders) > 0",outField:"arrayElemAt(media_id, 0) as media",token:o.token,uid:o.uid})}});!e.success&&((a=e.error)==null?void 0:a.message)&&/resource exhausted/.test(e.error.message),e.length?(U=e[0]._id.orders[0],e[0]._id.orders[0].startTime<=Date.now()||(t.value[0].checkbox="\u2714\uFE0F",t.value[0].status="\u6709",t.value[0].details=`\u300A${e[0].name}\u300B`)):(t.value[0].checkbox="\u274C",t.value[0].status="\u65E0",t.value[0].details="\u70B9\u51FB\u4E0B\u9762\u6309\u94AE\u53BB\u4E0B\u5355",E.value="\u70B9\u64AD\u4E00\u4E2A\u4E92\u52A8\u8282\u76EE")}catch(e){console.error("loadMore ProgramsList:",e)}}function M(){p.push({path:"/services/interact_run",query:{url:"test"}})}return(u,o)=>(F(),v(su,null,{default:s(()=>[r(G,null,{default:s(()=>[r(W,{class:"text-center"},{default:s(()=>[C(" \u8BF7\u9010\u6761\u68C0\u67E5\u4EE5\u4E0B\u5404\u9879 ")]),_:1})]),_:1}),r(tu,{separator:""},{default:s(()=>[(F(!0),P(S,null,w(t.value,(a,e)=>(F(),v(au,{key:e,"expand-separator":"",icon:a.checkbox,label:a.name+a.status,"label-lines":"1",caption:""},{default:s(()=>[r(T,null,{default:s(()=>[r(_,{avatar:""}),r(_,null,{default:s(()=>[r(N,null,{default:s(()=>[C(l(a.details),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["icon","label"]))),128))]),_:1}),c("div",cu,[c("div",iu,[r(eu,{class:"full-width",size:"18px",rounded:"",type:"button",color:"green",onClick:M},{default:s(()=>[C(l(E.value),1)]),_:1})])]),c("div",Fu,[(F(!0),P(S,null,w($.value,(a,e)=>(F(),v(T,{key:e,dense:""},{default:s(()=>[r(_,null,{default:s(()=>[r(N,null,{default:s(()=>[C(l(`${e+1}. `)+l(a),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),c("div",du,[c("div",null,"\u8DDD\u79BB\u55B7\u6CC9\uFF1A"+l(k.value)+" \u5343\u7C73",1),c("div",null,"\u6743\u9650\u72B6\u6001\uFF1A"+l(y.value),1),c("div",null,"\u7ECF\u5EA6\uFF1A"+l(g.value),1),c("div",null,"\u7EAC\u5EA6\uFF1A"+l(f.value),1)])]),_:1}))}});var xu=H(Eu,[["__scopeId","data-v-91970a64"]]);export{xu as default};
