import{d as W,r as _,w as X,m as u,n as h,p as m,j as n,z as F,aO as E,x as y,aU as $,v as O,aT as V,s as r,A as j,B as U,F as k,y as N,bc as A,aV as B,U as Z,bb as ee,Q as D,H as J}from"./index.4f390c6a.js";import{Q as le}from"./QFile.0b5cf431.js";import{Q as te}from"./QForm.c09e6959.js";import{Q as ae}from"./QPage.e32daf6c.js";import{u as oe}from"./use-quasar.4e14d354.js";import{u as ne}from"./SearchKey.a606d0cd.js";import{_ as se}from"./CollectionSelect.2d35001e.js";import{_ as ie}from"./UpdatedDate.47641b74.js";import{_ as P}from"./GroupSelect.989d4c58.js";import{m as ue}from"./constant.a3c7e21e.js";import{U as de}from"./cloudDB.d318324a.js";import"./QChip.17ac3977.js";import"./format.6396bb17.js";import"./QSelect.8ad877e3.js";import"./QItemLabel.95b24a48.js";import"./QMenu.75c03351.js";import"./selection.1482bdb7.js";import"./rtl.0738a96b.js";import"./index.d9f23821.js";import"./index.4024674e.js";import"./date.865a2574.js";import"./axios.ea5872bc.js";const re={class:"q-mb-md rounded-borders",style:{border:"1px lightgrey solid"}},ce=r("div",null,"attrib",-1),me={class:"q-gutter-x-lg q-gutter-y-md"},ve={class:"q-mb-md rounded-borders",style:{border:"1px lightgrey solid"}},pe=r("div",null,"type",-1),fe={class:"q-gutter-x-lg q-gutter-y-md"},ye={class:"q-mb-md row col justify-between"},be={class:"row col justify-between"},_e={key:0,class:"col row justify-between"},ge={class:"q-mt-md row justify-between"},Me=W({__name:"ExecEditor",setup(we){const S=oe(),q=ne(),d=_("Submit"),p=_(),f=_(),g=_(null),v=_(),R=["dim","rgb","tilt","pan","white"],I=["dcf","_dcf","vfd","led","led8","stepper","pump"],x={attrib:"dim",type:"vfd",members_qty:1,sub:1,overwritten:!1,block:!1,delay:[0,0]},l=_(x),C=de.getInstance();X(()=>g.value,async t=>{if(console.log("watch execFile:",t),t){const a=await t.arrayBuffer(),o=new TextDecoder("utf-8").decode(new Uint8Array(a)),c=JSON.parse(o);c.ma2Execs.length&&(d.value="Submit",await z(c.ma2Execs))}});function M(){q.getShow||q.toggleShow()}function w(){q.getShow&&q.toggleShow()}async function z(t){if(console.log("updateGroupsData execs:",t),t!=null&&t.length){let a="positive",e=" Added Successfully.";try{const o=await C.request("databaseCRUD/update",{query:{collection:"pcf-ma2-execs",condition:JSON.stringify({fountain_id:p.value})},body:JSON.stringify(t)});console.log("updateExecDocs res:",o),o.inserted>0&&o.ids?e=`${t==null?void 0:t.length} MA2 Exec Data`+e:(a="negative",e="No Doc Updated."),b(a,e)}catch(o){e=typeof o=="string"?o:JSON.stringify(o),b("negative",e)}}}function b(t,a){S.notify({type:t,message:a,icon:"cloud_done",position:"top",timeout:5e3})}async function G(){S.notify({type:"positive",position:"center",timeout:0,icon:"cloud_done",message:`${d.value} MA2 Exec: ${l.value.attrib} ?`,actions:[{label:"Cancel",color:"white",handler:()=>{}},{label:"Yes",color:"yellow",handler:async()=>{var t;if(console.log("onSubmit formData:",l.value),l.value&&v.value){let a="positive",e=" Successfully.";const o=l.value._id!=="newDoc"?{_id:l.value._id}:{fountain_id:p.value,name:l.value.attrib},c=Date.now(),i={...l.value,_id:void 0,updated_at:c};i.overwritten||(i.overwritten=void 0),i.block||(i.block=void 0),(t=i.delay)!=null&&t.every(s=>s===0)&&(i.delay=void 0),i.created_at||(i.created_at=c),console.log("onSubmit body:",i);try{const s=await C.request("databaseCRUD/update",{query:{collection:"pcf-ma2-execs",condition:JSON.stringify(o)},body:i});console.log("onSubmit doc res:",s),s.affectedDocs>0||s.id?(l.value.created_at||(l.value.created_at=i.created_at),l.value.updated_at=i.updated_at,d.value==="Submit"?(s.id&&(l.value._id=s.id,e=`Doc: ${s.id} Added`+e),d.value="Update"):d.value==="Update"&&(e=`${s.affectedDocs} Doc Updated`+e),v.value={...l.value}):(a="negative",e="No Doc Updated."),b(a,e)}catch(s){e=typeof s=="string"?s:JSON.stringify(s),b("negative",e)}}}}]})}function T(){l.value={...l.value,...x}}function Q(){l.value={...x},l.value._id="newDoc",l.value.group_id=f.value,v.value=l.value,d.value="Submit"}function L(){S.notify({message:`Delete Exec: ${l.value.attrib} ?`,color:"negative",position:"center",icon:"cloud_done",timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>{}},{label:"Yes",color:"yellow",handler:async()=>{if(l.value._id!=="newDoc"&&v.value&&f.value){let t="positive",a=" Successfully.";try{const e=await C.request("databaseCRUD/delete",{query:{collection:"pcf-ma2-execs",condition:JSON.stringify({_id:l.value._id})}});console.log("onDelete doc res:",e),(e==null?void 0:e.deleted)===1?(v.value.attrib="***deleted doc***",t="warning",a=`${e.affectedDocs} Doc Deleted`+a):(t="negative",a="No Doc Deleted."),b(t,a)}catch(e){a=typeof e=="string"?e:JSON.stringify(e),b("negative",a)}}}}]})}function Y(t){console.log("onFountainPick doc:",t),t&&t._id!==p.value&&(p.value=t._id)}function H(t){console.log("onGroupPick doc:",t),t._id!==f.value&&(f.value=t._id)}function K(t){console.log("onExecPick doc:",t),t?(l.value={...l.value,...t},t._id==="newDoc"?(v.value=l.value,d.value="Submit"):(v.value={...t},d.value="Update")):Q()}return(t,a)=>(u(),h(ae,{padding:"",class:"q-mx-sm"},{default:m(()=>[n(se,{onSelected:Y,onClick:M}),F(n(P,{class:"q-mt-sm",collection:"pcf-ma2-groups",id:p.value,onSelected:H,onClick:w},null,8,["id"]),[[E,p.value]]),p.value&&f.value?(u(),y(k,{key:0},[f.value?(u(),y("div",{key:0,class:$(["q-mt-lg",O(S).dark.isActive?"bg-grey-9":"bg-grey-3"]),rounded:""},[n(P,{collection:"pcf-ma2-execs",id:f.value,doc:v.value,onSelected:K,onClick:w},null,8,["id","doc"])],2)):V("",!0),F(r("div",null,[n(ie,{class:"q-mt-md",created_at:l.value.created_at,updated_at:l.value.updated_at},null,8,["created_at","updated_at"])],512),[[E,l.value.created_at&&l.value.updated_at]]),n(te,{class:"q-mt-md",autofocus:"",onSubmit:G,onReset:T},{default:m(()=>[r("div",re,[n(j,null,{default:m(()=>[n(U,{class:"",avatar:""},{default:m(()=>[ce]),_:1}),n(U,{class:""},{default:m(()=>[r("div",me,[(u(),y(k,null,N(R,e=>n(A,{key:e,modelValue:l.value.attrib,"onUpdate:modelValue":a[0]||(a[0]=o=>l.value.attrib=o),val:e,label:e,dense:""},null,8,["modelValue","val","label"])),64))])]),_:1})]),_:1})]),r("div",ve,[n(j,null,{default:m(()=>[n(U,{class:"",avatar:""},{default:m(()=>[pe]),_:1}),n(U,{class:""},{default:m(()=>[r("div",fe,[(u(),y(k,null,N(I,e=>n(A,{key:e,modelValue:l.value.type,"onUpdate:modelValue":a[1]||(a[1]=o=>l.value.type=o),val:e,label:e,dense:""},null,8,["modelValue","val","label"])),64))])]),_:1})]),_:1})]),r("div",ye,[n(B,{class:"col-6 q-pr-sm",modelValue:l.value.overwritten,"onUpdate:modelValue":a[2]||(a[2]=e=>l.value.overwritten=e),label:"overwritten"},null,8,["modelValue"]),n(B,{class:"col-6 q-pl-sm",modelValue:l.value.block,"onUpdate:modelValue":a[3]||(a[3]=e=>l.value.block=e),label:"block"},null,8,["modelValue"])]),r("div",be,[n(le,{class:"col-6 q-pr-sm",dense:"",outlined:"",modelValue:g.value,"onUpdate:modelValue":a[5]||(a[5]=e=>g.value=e),label:"load json file",accept:".json",onClick:w},{append:m(()=>[g.value?(u(),h(Z,{key:0,name:O(ue),onClick:a[4]||(a[4]=ee(e=>g.value=null,["stop","prevent"])),class:"cursor-pointer",color:"grey-5"},null,8,["name"])):(u(),h(D,{key:1,round:"",dense:"",flat:"",icon:"folder_open"}))]),_:1},8,["modelValue"]),n(J,{class:"col-6 q-pl-sm",outlined:"",modelValue:l.value.sub,"onUpdate:modelValue":a[6]||(a[6]=e=>l.value.sub=e),modelModifiers:{number:!0},type:"number",label:"sub index",hint:"",dense:"",clearable:"","lazy-rules":"",onFocus:w,rules:[e=>e&&e>0||"sub > 0"]},null,8,["modelValue","rules"])]),l.value.delay?(u(),y("div",_e,[(u(!0),y(k,null,N(l.value.delay,(e,o)=>(u(),h(J,{key:o,class:$(["col-6",o==0?"q-pr-sm":"q-pl-sm"]),outlined:"",modelValue:l.value.delay[o],"onUpdate:modelValue":c=>l.value.delay[o]=c,modelModifiers:{number:!0},type:"number",hint:"",dense:"",clearable:"",label:o==0?"startup delay":"response delay","lazy-rules":"",rules:[c=>c>=0||"delay >= 0"],onFocus:w},null,8,["class","modelValue","onUpdate:modelValue","label","rules"]))),128))])):V("",!0),r("div",ge,[d.value=="Update"?(u(),y(k,{key:0},[n(D,{dense:"",outline:"",color:"negative",icon:"add",round:"",onClick:Q}),n(D,{dense:"",outline:"",color:"negative",icon:"remove",round:"",onClick:L})],64)):V("",!0),n(D,{class:"q-px-md",dense:"","no-caps":"",unelevated:"",label:"Reset",type:"reset",color:"primary",icon:"restart_alt",outline:"",rounded:""}),n(D,{class:"q-px-md",dense:"",outline:"","no-caps":"",unelevated:"",label:d.value,type:"submit",color:"primary",icon:"cloud_upload",rounded:""},null,8,["label"])])]),_:1})],64)):V("",!0)]),_:1}))}});export{Me as default};
