import{Q as H}from"./QTab.9dfb2d2e.js";import{Q as Y}from"./QTabs.1c1f66ed.js";import{d as G,r as v,w as P,m as s,n as f,p as u,s as i,x as d,y as w,j as t,F as b,aT as U,B as h,Q as V,q as K,t as W,A as C,H as y,bc as X,br as Z}from"./index.4f390c6a.js";import{Q as j}from"./QSelect.8ad877e3.js";import{Q as ee}from"./QForm.c09e6959.js";import{Q as le}from"./QPage.e32daf6c.js";import{u as ae}from"./use-quasar.4e14d354.js";import{U as te}from"./cloudDB.d318324a.js";import"./QResizeObserver.cb7e3544.js";import"./rtl.0738a96b.js";import"./QChip.17ac3977.js";import"./QItemLabel.95b24a48.js";import"./QMenu.75c03351.js";import"./selection.1482bdb7.js";import"./format.6396bb17.js";import"./axios.ea5872bc.js";import"./constant.a3c7e21e.js";const oe={class:"bg-grey-3 q-my-lg",rounded:""},se={key:0,class:"bg-grey-3 q-my-lg",rounded:""},ne={class:"row q-px-sm justify-start items-center"},ue={class:"row col justify-between"},re={class:"q-my-md rounded-borders",style:{border:"1px lightgrey solid"}},ie=i("div",null,"slider",-1),de={class:"row justify-around"},ce={key:0,class:"q-my-md rounded-borders",style:{border:"1px lightgrey solid"}},ve=i("div",null,"values",-1),me={class:"q-gutter-x-lg"},pe={class:"row justify-between"},Pe=G({__name:"EffectAttribEditor",setup(fe){const k=ae(),r=v("Submit"),Q=["24","4","5","13","7"],S=["24","7","6"],z=["\u5168","\u5947","\u5076","1/3","2/3","3/3","1/4","2/4","3/4","4/4"],B=[">","<","><","<>"],O=["0 ","2 ","-2 ","3","4"],I=["0","2","3","4","5","6","8","9","10"],R=["black","red","yellow","green","cyan","deep-blue","purple","white"],_=v([]),n=v([]),D=["analog","switch"],E=["form","interleave","direction","wings","groups","highlow","phase","width","rate"],g=v("analog"),F=v(1),x=["vfd","led","stepper","dcf","_dcf","pump","led8","motor"],m=v([]),J=["selector","fader","range"],N={name:"",types:[],level:1,slider:"",current:void 0,min:void 0,max:void 0,step:void 0,unit:void 0,values:void 0},e=v(N),q=te.getInstance();P(()=>g.value,o=>{console.log("watch currentExecAttribCategory:",g.value),m.value=o==="analog"?x.slice(0,3):x.slice(3);let a=[];o==="analog"?(m.value=x.slice(0,3),e.value.name==="form"&&(a=Q)):(m.value=x.slice(3),e.value.name==="form"&&(a=S)),c(a),console.log("watch types:",m.value)},{immediate:!0}),P(()=>e.value.name,async o=>{if(console.log("watch formData.value.name:",e.value.name),o){const a=await q.request("databaseCRUD/get",{query:{collection:"pcf-ma2-effect-attributes",condition:JSON.stringify({name:e.value.name}),body:JSON.stringify(e.value)}});switch(console.log("watch formData.value.name:",a),a.data.length?(n.value=a.data,F.value=a.data[0].level,r.value="Update"):(n.value=[],r.value="Submit"),o){case"form":e.value.slider="selector";const l=g.value==="analog"?Q:S;c(l);break;case"interleave":e.value.slider="selector",c(z);break;case"direction":e.value.slider="selector",c(B);break;case"wings":e.value.slider="selector",c(O);break;case"groups":e.value.slider="selector",c(I);break;case"highlow":e.value.slider="range",m.value.includes("led8")?(e.value.unit=void 0,e.value.current="6..4",e.value.min=1,e.value.max=8,e.value.step=1,c(R)):(e.value.unit="%",e.value.current="100..0",e.value.min=0,e.value.max=100,e.value.step=1);break;case"width":e.value.slider="fader",e.value.unit="%",e.value.current=50,e.value.min=0,e.value.max=100,e.value.step=1;break;case"phase":e.value.slider="range",e.value.unit="\xB0",e.value.current="360..0",e.value.min=0,e.value.max=360,e.value.step=1;break;case"rate":e.value.slider="fader",e.value.unit="x",e.value.current=.2,e.value.min=0,e.value.max=.94,e.value.step=.01;break;default:e.value.unit=void 0;break}console.log("watch formData.value.unit:",e.value.unit)}});function c(o){if(o.length){_.value=[];for(const a of o)_.value.push({label:a,enable:!1})}}async function L(){if(console.log("onSubmit formData:",e.value),e.value.name.length===0)k.notify({color:"negative",textColor:"yellow",position:"center",icon:"cloud_done",message:"Please Select Name!"});else{const o=await q.request("databaseCRUD/update",{query:{collection:"pcf-ma2-effect-attributes",condition:JSON.stringify({name:e.value.name,level:e.value.level}),body:JSON.stringify(e.value)}});if(console.log("onSubmit res:",o),o.affectedDocs>0||o.id){if(r.value==="Submit")n.value.push(e.value),r.value="Update";else if(r.value==="Update"){const a=n.value.findIndex(l=>l.name===e.value.name);n.value[a]={...e.value}}}k.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"Submitted"})}}function T(){e.value=N,r.value="Submit"}function $(){}function M(){k.notify({message:`Delete ${e.value.name}, level: ${e.value.level}  ?`,color:"negative",position:"center",icon:"cloud_done",timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>{}},{label:"Yes",color:"yellow",handler:async()=>{if(n.value.length&&e.value){const o=await q.request("databaseCRUD/delete",{query:{collection:"pcf-ma2-effect-attributes",condition:JSON.stringify({name:e.value.name,level:e.value.level})}});if(console.log("execs res:",o),o.deleted===1){const a=n.value.findIndex(l=>l.level===e.value.level);n.value.splice(a,1),n.value.length&&A(n.value[0].level)}}}}]})}function A(o){const a=n.value.find(l=>l.level===o);a&&(e.value=a,delete e.value._id,r.value="Update")}return(o,a)=>(s(),f(le,{padding:"",class:"q-mx-sm"},{default:u(()=>[i("div",oe,[D.length?(s(),f(Y,{key:0,modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=l=>g.value=l),dense:"","inline-label":"",class:"col text-purple-3","active-color":"purple"},{default:u(()=>[(s(),d(b,null,w(D,(l,p)=>t(H,{class:"col",key:p,name:l,label:l},null,8,["name","label"])),64))]),_:1},8,["modelValue"])):U("",!0)]),n.value.length?(s(),d("div",se,[t(C,{class:"q-pa-none q-ma-none",dense:""},{default:u(()=>[t(h,{class:""},{default:u(()=>[i("div",ne,[(s(!0),d(b,null,w(n.value,l=>(s(),f(V,{key:l.level,class:"col-2",size:"16px",color:l.level==e.value.level?"positive":"grey","text-color":"",dense:"",flat:l.level!=e.value.level,onClick:p=>A(l.level)},{default:u(()=>[K(W(l.level),1)]),_:2},1032,["color","flat","onClick"]))),128))])]),_:1})]),_:1})])):U("",!0),t(ee,{class:"",onSubmit:L,onReset:T},{default:u(()=>[i("div",ue,[t(y,{class:"col-6 q-pr-sm",outlined:"",modelValue:e.value.level,"onUpdate:modelValue":a[1]||(a[1]=l=>e.value.level=l),modelModifiers:{number:!0},type:"number",label:"level",hint:"",dense:"","lazy-rules":"",rules:[l=>l>0||"Please type something"]},null,8,["modelValue","rules"]),t(j,{class:"col-6 q-pl-sm",outlined:"",modelValue:e.value.name,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.name=l),options:E,dense:!0,"options-dense":!1,"hide-dropdown-icon":"",label:"name","stack-label":""},null,8,["modelValue"])]),t(j,{class:"full-width q-mb-md",outlined:"",modelValue:e.value.types,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.types=l),options:m.value,dense:!0,"options-dense":!1,"hide-dropdown-icon":"",label:"types","stack-label":""},null,8,["modelValue","options"]),i("div",re,[t(C,null,{default:u(()=>[t(h,{class:"",avatar:""},{default:u(()=>[ie]),_:1}),t(h,{class:""},{default:u(()=>[i("div",de,[(s(),d(b,null,w(J,l=>t(X,{key:l,modelValue:e.value.slider,"onUpdate:modelValue":a[4]||(a[4]=p=>e.value.slider=p),val:l,label:l,dense:""},null,8,["modelValue","val","label"])),64))])]),_:1})]),_:1})]),e.value.slider==="selector"||e.value.types.includes("led8")?(s(),d("div",ce,[t(C,null,{default:u(()=>[t(h,{class:"",avatar:""},{default:u(()=>[ve]),_:1}),t(h,{class:""},{default:u(()=>[i("div",me,[(s(!0),d(b,null,w(_.value,l=>(s(),f(Z,{key:l.label,modelValue:l.enable,"onUpdate:modelValue":p=>l.enable=p,label:l.label,dense:""},null,8,["modelValue","onUpdate:modelValue","label"]))),128))])]),_:1})]),_:1})])):(s(),d(b,{key:1},[e.value.slider==="range"?(s(),f(y,{key:0,outlined:"",modelValue:e.value.current,"onUpdate:modelValue":a[5]||(a[5]=l=>e.value.current=l),label:"current",hint:"",dense:"","lazy-rules":"",rules:[l=>l===void 0||l.length>0||"Please type something"]},null,8,["modelValue","rules"])):(s(),f(y,{key:1,outlined:"",modelValue:e.value.current,"onUpdate:modelValue":a[6]||(a[6]=l=>e.value.current=l),modelModifiers:{number:!0},type:"number",label:"current",hint:"",dense:"","lazy-rules":"",rules:[l=>l===void 0||l>=0||"Please type something"]},null,8,["modelValue","rules"])),t(y,{outlined:"",modelValue:e.value.min,"onUpdate:modelValue":a[7]||(a[7]=l=>e.value.min=l),label:"min",hint:"",dense:"","lazy-rules":"",rules:[l=>l===void 0||l>=0||"Please type something"]},null,8,["modelValue","rules"]),t(y,{outlined:"",modelValue:e.value.max,"onUpdate:modelValue":a[8]||(a[8]=l=>e.value.max=l),label:"max",hint:"",dense:"","lazy-rules":"",rules:[l=>l===void 0||l>0||"Please type something"]},null,8,["modelValue","rules"]),t(y,{outlined:"",modelValue:e.value.step,"onUpdate:modelValue":a[9]||(a[9]=l=>e.value.step=l),label:"step",hint:"",dense:"","lazy-rules":"",rules:[l=>l===void 0||l>0||"Please type something"]},null,8,["modelValue","rules"])],64)),i("div",pe,[r.value=="Update"?(s(),d(b,{key:0},[t(V,{dense:"",outline:"",color:"negative",icon:"add",round:"",onClick:$}),t(V,{dense:"",outline:"",color:"negative",icon:"remove",round:"",onClick:M})],64)):U("",!0),t(V,{class:"q-px-md",dense:"","no-caps":"",unelevated:"",label:"Reset",type:"reset",color:"primary",icon:"restart_alt",outline:"",rounded:""}),t(V,{class:"q-px-md",dense:"",outline:"","no-caps":"",unelevated:"",label:r.value,type:"submit",color:"primary",icon:"cloud_upload",rounded:""},null,8,["label"])])]),_:1})]),_:1}))}});export{Pe as default};
