import{d as P,r as y,w as B,m,n as w,p as v,j as t,x as q,z as J,aO as A,s as r,H as g,U as z,v as M,bb as R,Q as b,A as I,B as N,F as V,y as E,bc as L,aT as C}from"./index.4f390c6a.js";import{Q as T}from"./QFile.0b5cf431.js";import{Q as Y}from"./QForm.c09e6959.js";import{Q as H}from"./QPage.e32daf6c.js";import{u as K}from"./use-quasar.4e14d354.js";import{u as W}from"./SearchKey.a606d0cd.js";import{_ as X}from"./CollectionSelect.2d35001e.js";import{_ as Z}from"./GroupSelect.989d4c58.js";import{U as ee}from"./cloudDB.d318324a.js";import{m as le}from"./constant.a3c7e21e.js";import{_ as ae}from"./UpdatedDate.47641b74.js";import"./QChip.17ac3977.js";import"./format.6396bb17.js";import"./QSelect.8ad877e3.js";import"./QItemLabel.95b24a48.js";import"./QMenu.75c03351.js";import"./selection.1482bdb7.js";import"./rtl.0738a96b.js";import"./index.d9f23821.js";import"./index.4024674e.js";import"./axios.ea5872bc.js";import"./date.865a2574.js";const oe={class:"q-mt-md row col justify-between"},te={class:"row col justify-between"},ne={class:"row col justify-between"},se={class:"q-mb-md rounded-borders",style:{border:"1px lightgrey solid"}},ie=r("div",null,"state",-1),ue={class:"q-gutter-x-lg q-gutter-y-sm"},de={class:"q-my-lg row justify-between"},$e=P({__name:"GroupEditor",setup(re){const D=K(),_=W(),u=y("Submit"),f=y(null),d=y(),c=y(),S={name:"",alias:"",index:1,devices:1,level:1,state:1},l=y({...S}),h=ee.getInstance();B(()=>f.value,async o=>{if(console.log("watch groupFile:",o),o){const a=await o.arrayBuffer(),n=new TextDecoder("utf-8").decode(new Uint8Array(a)),s=JSON.parse(n);s.ma2Groups.length&&(u.value="Submit",await x(s.ma2Groups))}});function Q(){_.getShow||_.toggleShow()}function U(){_.getShow&&_.toggleShow()}async function x(o){if(console.log("updateGroupDocs groups:",o),o!=null&&o.length){let a="positive",e=" Added Successfully.";try{const n=await h.request("databaseCRUD/update",{query:{collection:"pcf-ma2-groups",condition:JSON.stringify({fountain_id:c.value})},body:JSON.stringify(o)});console.log("updateGroupDocs res:",n),n.inserted>0&&n.ids?e=`${o==null?void 0:o.length} MA2 Group Data`+e:(a="negative",e="No Doc Updated."),p(a,e)}catch(n){e=typeof n=="string"?n:JSON.stringify(n),p("negative",e)}}}function p(o,a){D.notify({type:o,message:a,icon:"cloud_done",position:"top",timeout:5e3})}async function F(){D.notify({type:"positive",position:"center",timeout:0,icon:"cloud_done",message:`${u.value} MA2 Group: ${l.value.name} ?`,actions:[{label:"Cancel",color:"white",handler:()=>{}},{label:"Yes",color:"yellow",handler:async()=>{if(console.log("onSubmit formData:",l.value),l.value&&d.value){let o="positive",a=" Successfully.";const e=l.value._id!=="newDoc"?{_id:l.value._id}:{fountain_id:c.value,name:l.value.name},n=Date.now(),s={...l.value,_id:void 0,updated_at:n};s.created_at||(s.created_at=n),console.log("onSubmit body:",s);try{const i=await h.request("databaseCRUD/update",{query:{collection:"pcf-ma2-groups",condition:JSON.stringify(e)},body:s});console.log("onSubmit doc res:",i),i.affectedDocs>0||i.id?(l.value.created_at||(l.value.created_at=s.created_at),l.value.updated_at=s.updated_at,u.value==="Submit"?(i.id&&(l.value._id=i.id,a=`Doc: ${i.id} Added`+a),u.value="Update"):u.value==="Update"&&(a=`${i.affectedDocs} Doc Updated`+a),d.value={...l.value}):(o="negative",a="No Doc Updated."),p(o,a)}catch(i){a=typeof i=="string"?i:JSON.stringify(i),p("negative",a)}}}}]})}function $(){l.value={...l.value,...S}}function k(){l.value={...S},l.value._id="newDoc",l.value.fountain_id=c.value,d.value=l.value,u.value="Submit"}function G(){D.notify({message:`Delete Group: ${l.value.name} ?`,color:"negative",position:"center",icon:"cloud_done",timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>{}},{label:"Yes",color:"yellow",handler:async()=>{if(l.value._id!=="newDoc"&&d.value){let o="positive",a=" Successfully.";try{const e=await h.request("databaseCRUD/delete",{query:{collection:"pcf-ma2-groups",condition:JSON.stringify({_id:l.value._id})}});console.log("onDelete doc res:",e),(e==null?void 0:e.deleted)===1?(d.value.name="***deleted doc***",o="warning",a=`${e.affectedDocs} Doc Deleted`+a):(o="negative",a="No Doc Deleted."),p(o,a)}catch(e){a=typeof e=="string"?e:JSON.stringify(e),p("negative",a)}}}}]})}function O(o){console.log("onFountainPick data:",o),o&&o._id!==c.value&&(c.value=o._id)}async function j(o){console.log("onGroupPick doc:",o),o?(l.value={...o},o._id==="newDoc"?(d.value=l.value,u.value="Submit"):(d.value={...o},u.value="Update")):k()}return(o,a)=>(m(),w(H,{padding:"",class:"q-mx-sm"},{default:v(()=>[t(X,{class:"q-mt-md",onSelected:O,onClick:Q}),c.value?(m(),q(V,{key:0},[t(Z,{class:"q-mt-md",collection:"pcf-ma2-groups",id:c.value,doc:d.value,onSelected:j,onClick:U},null,8,["id","doc"]),J(r("div",null,[t(ae,{class:"q-my-md",created_at:l.value.created_at,updated_at:l.value.updated_at},null,8,["created_at","updated_at"])],512),[[A,l.value.created_at&&l.value.updated_at]]),t(Y,{class:"q-mt-lg",autofocus:"",onSubmit:F,onReset:$},{default:v(()=>[r("div",oe,[t(g,{class:"col-6 q-pr-sm",modelValue:l.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value.name=e),label:"name",hint:"",outlined:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>e.length>0||"Please type something"],onFocus:U},null,8,["modelValue","rules"]),t(T,{class:"col-6 q-pl-sm",dense:"",outlined:"",modelValue:f.value,"onUpdate:modelValue":a[2]||(a[2]=e=>f.value=e),label:"load json file",accept:".json"},{append:v(()=>[f.value?(m(),w(z,{key:0,name:M(le),onClick:a[1]||(a[1]=R(e=>f.value=null,["stop","prevent"])),class:"cursor-pointer",color:"grey-5"},null,8,["name"])):(m(),w(b,{key:1,round:"",dense:"",flat:"",icon:"folder_open"}))]),_:1},8,["modelValue"])]),r("div",te,[t(g,{class:"col-6 q-pr-sm",modelValue:l.value.alias,"onUpdate:modelValue":a[3]||(a[3]=e=>l.value.alias=e),label:"alias",hint:"",outlined:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>e.length>0||"Please type something"]},null,8,["modelValue","rules"]),t(g,{class:"col-6 q-pl-sm",outlined:"",modelValue:l.value.index,"onUpdate:modelValue":a[4]||(a[4]=e=>l.value.index=e),modelModifiers:{number:!0},type:"number",label:"index",hint:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>e>0||"Please type something"]},null,8,["modelValue","rules"])]),r("div",ne,[t(g,{class:"col-6 q-pr-sm",outlined:"",modelValue:l.value.devices,"onUpdate:modelValue":a[5]||(a[5]=e=>l.value.devices=e),modelModifiers:{number:!0},type:"number",label:"devices",hint:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>e&&e>0||"Please type something"]},null,8,["modelValue","rules"]),t(g,{class:"col-6 q-pl-sm",outlined:"",modelValue:l.value.level,"onUpdate:modelValue":a[6]||(a[6]=e=>l.value.level=e),modelModifiers:{number:!0},type:"number",label:"level",hint:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>e>0||"Please type something"]},null,8,["modelValue","rules"])]),r("div",se,[t(I,null,{default:v(()=>[t(N,{class:"q-mr-lg",avatar:""},{default:v(()=>[ie]),_:1}),t(N,{class:""},{default:v(()=>[r("div",ue,[(m(!0),q(V,null,E(o.$t("state.show").split(","),(e,n)=>(m(),w(L,{key:n,modelValue:l.value.state,"onUpdate:modelValue":a[7]||(a[7]=s=>l.value.state=s),val:n,label:e,dense:""},null,8,["modelValue","val","label"]))),128))])]),_:1})]),_:1})]),r("div",de,[u.value=="Update"?(m(),q(V,{key:0},[t(b,{dense:"",outline:"",color:"negative",icon:"add",round:"",onClick:k}),t(b,{dense:"",outline:"",color:"negative",icon:"remove",round:"",onClick:G})],64)):C("",!0),t(b,{class:"q-px-md",dense:"","no-caps":"",unelevated:"",label:"Reset",type:"reset",color:"primary",icon:"restart_alt",outline:"",rounded:""}),t(b,{class:"q-px-md",dense:"",outline:"","no-caps":"",unelevated:"",label:u.value,type:"submit",color:"primary",icon:"cloud_upload",rounded:""},null,8,["label"])])]),_:1})],64)):C("",!0)]),_:1}))}});export{$e as default};
