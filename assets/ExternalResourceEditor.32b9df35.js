import{d as z,r as p,w as $,m as h,n as J,p as U,j as a,z as Q,aO as j,s as y,H as d,x as B,Q as g,F as R,aT as A}from"./index.4f390c6a.js";import{Q as E}from"./QForm.c09e6959.js";import{Q as P}from"./QPage.e32daf6c.js";import{u as G}from"./use-quasar.4e14d354.js";import{u as I}from"./SearchKey.a606d0cd.js";import{_ as L}from"./GroupSelect.989d4c58.js";import{U as M}from"./cloudDB.d318324a.js";import{_ as T}from"./UpdatedDate.47641b74.js";import"./QSelect.8ad877e3.js";import"./QChip.17ac3977.js";import"./QItemLabel.95b24a48.js";import"./QMenu.75c03351.js";import"./selection.1482bdb7.js";import"./rtl.0738a96b.js";import"./format.6396bb17.js";import"./index.4024674e.js";import"./axios.ea5872bc.js";import"./constant.a3c7e21e.js";import"./date.865a2574.js";const Y={class:"row col justify-between"},H={class:"row col justify-between"},K={class:"q-my-lg row justify-between"},ge=z({__name:"ExternalResourceEditor",setup(W){const _=G(),v=I(),i=p("Submit"),q=p(null),r=p(),S=p(),b=p(""),w={name:"",host:"",app_id:"",device_id:"",data_stream:"",secret_key:"",api_key:"",token_url:"",timeout:5e3},l=p({...w}),D=M.getInstance();$(()=>q.value,async o=>{if(console.log("watch docFile:",o),o){const t=await o.arrayBuffer(),n=new TextDecoder("utf-8").decode(new Uint8Array(t)),{docs:s}=JSON.parse(n);s.length&&(i.value="Submit",await F(s))}});function C(){v.getShow||v.toggleShow()}function c(){v.getShow&&v.toggleShow()}async function F(o){if(console.log("updateDocs2Cloud docs:",o),o!=null&&o.length){let t="positive",e=" Added Successfully.";try{const n=await D.request("databaseCRUD/update",{query:{collection:"pcf-external-resources",condition:JSON.stringify({fountain_id:S.value})},body:JSON.stringify(o)});console.log("updateGroupDocs res:",n),n.inserted>0&&n.ids?e=`${n.inserted} MA2 Group Data`+e:(t="negative",e="No Doc Updated."),m(t,e)}catch(n){e=typeof n=="string"?n:JSON.stringify(n),m("negative",e)}}}function m(o,t){_.notify({type:o,message:t,icon:"cloud_done",position:"top",timeout:5e3})}async function V(){console.log("onSubmit entry!"),_.notify({type:"positive",position:"center",timeout:0,icon:"cloud_done",message:`${i.value} Switch Command: ${l.value.name} ?`,actions:[{label:"Cancel",color:"white",handler:()=>{}},{label:"Yes",color:"yellow",handler:async()=>{if(console.log("onSubmit formData:",l.value),l.value&&r.value){let o="positive",t=" Successfully.";const e=l.value._id!=="newDoc"?{_id:l.value._id}:{fountain_id:S.value,name:l.value.name},n=Date.now(),s={...l.value,_id:void 0,updated_at:n};let f;for(f in s)typeof s[f]=="string"&&s[f]===""&&(s[f]=void 0);s.created_at||(s.created_at=n),console.log("onSubmit body:",s);try{const u=await D.request("databaseCRUD/update",{query:{collection:"pcf-external-resources",condition:JSON.stringify(e)},body:s});console.log("onSubmit doc res:",u),u.affectedDocs>0||u.id?(l.value.created_at||(l.value.created_at=s.created_at),l.value.updated_at=s.updated_at,i.value==="Submit"?(u.id&&(l.value._id=u.id,t=`Doc: ${u.id} Added`+t),i.value="Update"):i.value==="Update"&&(t=`${u.affectedDocs} Doc Updated`+t),r.value={...l.value}):(o="negative",t="No Doc Updated."),m(o,t)}catch(u){t=typeof u=="string"?u:JSON.stringify(u),m("negative",t)}}}}]})}function N(){console.log("onReset entry!"),l.value={...l.value,...w},b.value=""}function k(){l.value={...w},l.value._id="newDoc",b.value="",r.value=l.value,i.value="Submit"}function x(){_.notify({message:`Delete Switch Command: ${l.value.name} ?`,color:"negative",position:"center",icon:"cloud_done",timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>{}},{label:"Yes",color:"yellow",handler:async()=>{if(l.value._id!=="newDoc"&&r.value){let o="positive",t=" Successfully.";try{const e=await D.request("databaseCRUD/delete",{query:{collection:"pcf-external-resources",condition:JSON.stringify({_id:l.value._id})}});console.log("onDelete doc res:",e),(e==null?void 0:e.deleted)===1?(r.value.name="***deleted doc***",o="warning",t=`${e.affectedDocs} Doc Deleted`+t):(o="negative",t="No Doc Deleted."),m(o,t)}catch(e){t=typeof e=="string"?e:JSON.stringify(e),m("negative",t)}}}}]})}async function O(o){console.log("onDocumentPick doc:",o),o?(l.value={...o},b.value="",o._id==="newDoc"?(r.value=l.value,i.value="Submit"):(r.value={...o},i.value="Update")):k()}return(o,t)=>(h(),J(P,{padding:"",class:"q-mx-sm"},{default:U(()=>[a(L,{class:"q-mt-md",collection:"pcf-external-resources",doc:r.value,onSelected:O,onClick:C},null,8,["doc"]),Q(y("div",null,[a(T,{class:"q-my-md",created_at:l.value.created_at,updated_at:l.value.updated_at},null,8,["created_at","updated_at"])],512),[[j,l.value.created_at&&l.value.updated_at]]),a(E,{class:"q-mt-lg",autofocus:"",onSubmit:V,onReset:N},{default:U(()=>[a(d,{class:"",modelValue:l.value.name,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value.name=e),label:"name",outlined:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>e&&e.length>0||"name length > 0"],onFocus:c},null,8,["modelValue","rules"]),a(d,{class:"",modelValue:l.value.host,"onUpdate:modelValue":t[1]||(t[1]=e=>l.value.host=e),label:"host",outlined:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>e&&e.length>0||"host length > 0"],onFocus:c},null,8,["modelValue","rules"]),a(d,{class:"",outlined:"",modelValue:l.value.token_url,"onUpdate:modelValue":t[2]||(t[2]=e=>l.value.token_url=e),label:"token url",dense:"",clearable:"","lazy-rules":"",rules:[e=>typeof e=="string"||"token url length >= 0"],onFocus:c},null,8,["modelValue","rules"]),a(d,{class:"",outlined:"",modelValue:l.value.api_key,"onUpdate:modelValue":t[3]||(t[3]=e=>l.value.api_key=e),label:"api key",dense:"",clearable:"","lazy-rules":"",rules:[e=>typeof e=="string"||"api key length >= 0"],onFocus:c},null,8,["modelValue","rules"]),a(d,{class:"",outlined:"",modelValue:l.value.secret_key,"onUpdate:modelValue":t[4]||(t[4]=e=>l.value.secret_key=e),label:"secret key",dense:"",clearable:"","lazy-rules":"",rules:[e=>typeof e=="string"||"secret key length >= 0"]},null,8,["modelValue","rules"]),y("div",Y,[a(d,{class:"col-6 q-pr-sm",modelValue:l.value.app_id,"onUpdate:modelValue":t[5]||(t[5]=e=>l.value.app_id=e),label:"app_id",outlined:"",dense:"",clearable:"","lazy-rules":"",rules:[e=>typeof e=="string"||"app_id length > 0"],onFocus:c},null,8,["modelValue","rules"]),a(d,{class:"col-6 q-pl-sm",outlined:"",modelValue:l.value.device_id,"onUpdate:modelValue":t[6]||(t[6]=e=>l.value.device_id=e),label:"device_id",dense:"",clearable:"","lazy-rules":"",rules:[e=>typeof e=="string"||"app_id length > 0"],onFocus:c},null,8,["modelValue","rules"])]),y("div",H,[a(d,{class:"col-6 q-pr-sm",modelValue:l.value.data_stream,"onUpdate:modelValue":t[7]||(t[7]=e=>l.value.data_stream=e),label:"data_stream",outlined:"",dense:"",clearable:"","lazy-rules":"",onFocus:c,rules:[e=>typeof e=="string"||"data_stream length >= 0"]},null,8,["modelValue","rules"]),a(d,{class:"col-6 q-pl-sm",outlined:"",modelValue:l.value.timeout,"onUpdate:modelValue":t[8]||(t[8]=e=>l.value.timeout=e),modelModifiers:{number:!0},type:"number",label:"timeout",dense:"",clearable:"","lazy-rules":"",onFocus:c,rules:[e=>e>=2e3||"timeout > 2000"]},null,8,["modelValue","rules"])]),y("div",K,[i.value=="Update"?(h(),B(R,{key:0},[a(g,{dense:"",outline:"",unelevated:"",color:"negative",icon:"add",round:"",onClick:k}),a(g,{dense:"",outline:"",unelevated:"",color:"negative",icon:"remove",round:"",onClick:x})],64)):A("",!0),a(g,{class:"q-px-md",dense:"",outline:"",rounded:"","no-caps":"",unelevated:"",label:"Reset",type:"reset",color:"primary",icon:"restart_alt"}),a(g,{class:"q-px-md",dense:"",outline:"",rounded:"","no-caps":"",unelevated:"",label:i.value,type:"button",color:"primary",icon:"cloud_upload",onClick:V},null,8,["label"])])]),_:1})]),_:1}))}});export{ge as default};
