import{d as B,r as V,l as $,m as r,n as q,p as i,j as a,aT as _,s as n,G as z,H as y,A as w,B as v,x as p,y as N,br as A,F as g,bc as O,Q as h}from"./index.4f390c6a.js";import{Q as P}from"./QForm.c09e6959.js";import{Q as j}from"./QPage.e32daf6c.js";import{u as R}from"./use-quasar.4e14d354.js";import{U as I}from"./cloudDB.d318324a.js";import{u as F}from"./SearchKey.a606d0cd.js";import{_ as Y}from"./CollectionSelect.2d35001e.js";import{_ as L}from"./UpdatedDate.47641b74.js";import"./axios.ea5872bc.js";import"./constant.a3c7e21e.js";import"./QSelect.8ad877e3.js";import"./QChip.17ac3977.js";import"./QItemLabel.95b24a48.js";import"./QMenu.75c03351.js";import"./selection.1482bdb7.js";import"./rtl.0738a96b.js";import"./format.6396bb17.js";import"./index.d9f23821.js";import"./index.4024674e.js";import"./date.865a2574.js";const T={class:"row col justify-between"},G={class:"col-3"},H=["src"],K={class:"col-9 q-pl-md"},M={class:"row col justify-between"},W={class:"q-mb-md rounded-borders",style:{border:"1px lightgrey solid"}},X=n("div",null,"role",-1),Z={class:"q-gutter-x-md"},ee={key:0,class:"q-mb-md rounded-borders",style:{border:"1px lightgrey solid"}},le=n("div",null,"gender",-1),ae={class:"q-gutter-x-md"},te={key:1,class:"q-mb-md rounded-borders",style:{border:"1px lightgrey solid"}},se=n("div",null,"status",-1),oe={class:"q-gutter-x-md"},ne={class:"q-my-lg row justify-between"},Oe=B({__name:"UserEditor",setup(ie){const b=R(),f=F(),u=V("Submit"),x=["\u6B63\u5E38","\u7981\u7528","\u5BA1\u6838\u4E2D","\u5BA1\u6838\u62D2\u7EDD"],J=["\u672A\u77E5","\u7537","\u5973"],c=V([{label:"visitor",isEnable:!1},{label:"manager",isEnable:!1},{label:"debugger",isEnable:!1},{label:"developer",isEnable:!1},{label:"client",isEnable:!1},{label:"superior",isEnable:!1}]),S={name:"",nickname:"",status:0,gender:0,email:"",mobile:""},e=V(JSON.parse(JSON.stringify(S)));let d;const E=I.getInstance();$(async()=>{f.isEnable||f.toggleEnable(),f.isShow&&f.toggleShow()});function U(o){o?(d=JSON.parse(JSON.stringify(o)),e.value=JSON.parse(JSON.stringify(o)),c.value.forEach(s=>{e.value.role&&(s.isEnable=e.value.role.includes(s.label))}),console.log("watch user roles:",c.value),e.value.avatar||(e.value.avatar=""),!e.value.created_at&&e.value.updated_at&&(e.value.created_at=e.value.updated_at),u.value="Update"):(e.value=JSON.parse(JSON.stringify(S)),d=void 0,u.value="Submit")}function k(){d?e.value=JSON.parse(JSON.stringify(d)):(e.value=JSON.parse(JSON.stringify(S)),c.value.forEach(o=>o.isEnable=!1),u.value="Submit")}async function D(){b.notify({type:"positive",position:"center",timeout:0,icon:"cloud_done",message:`${u.value} Program: ${e.value.name} ?`,actions:[{label:"Cancel",color:"white",handler:()=>{}},{label:"Yes",color:"yellow",handler:async()=>{if(console.log("onSubmit formData:",e.value),e.value.role){const t=[];for(const m in c.value)c.value[m].isEnable&&t.push(c.value[m].label);e.value.role=t}const o=e.value._id?{_id:e.value._id}:{name:e.value.name},s=Date.now(),l={...e.value,_id:void 0,updated_at:s};l.created_at||(l.created_at=s),console.log("onSubmit body:",l);try{const t=await E.request("databaseCRUD/update",{query:{collection:"uni-id-users",condition:JSON.stringify(o),body:JSON.stringify(l)}});console.log("onSubmit res:",t),(t.affectedDocs>0||t.id)&&(e.value.created_at||(e.value.created_at=l.created_at),e.value.updated_at=l.updated_at,u.value==="Submit"&&(t.id&&(e.value._id=t.id,d=JSON.parse(JSON.stringify(e.value))),u.value="Update"))}catch(t){b.notify({type:"negative",position:"center",message:typeof t=="string"?t:JSON.stringify(t)})}}}]})}function Q(){b.notify({message:"Add a New Show ?",type:"positive",position:"center",icon:"cloud_done",timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>{}},{label:"Yes",color:"yellow",handler:async()=>{k()}}]})}function C(){b.notify({message:`Delete ${e.value.name} ?`,type:"negative",position:"center",icon:"cloud_done",timeout:0,actions:[{label:"Cancel",color:"white",handler:()=>{}},{label:"Yes",color:"yellow",handler:async()=>{if(u.value="Update")try{const o=await E.request("databaseCRUD/delete",{query:{collection:"uni-id-users",condition:JSON.stringify({_id:e.value._id})}});console.log("onDelete program res:",o),o.deleted===1&&d&&(f.key=d.nickname?d.nickname:"z")}catch(o){b.notify({type:"negative",position:"center",icon:"remove_circle",timeout:0,message:`Delete Show ${e.value.name} Error: ${o}`})}}}]})}return(o,s)=>(r(),q(j,{padding:"",class:"q-mx-sm"},{default:i(()=>[a(Y,{collection:"uni-id-users",onSelected:U}),e.value.created_at&&e.value.updated_at?(r(),q(L,{key:0,class:"q-my-md",created_at:e.value.created_at,updated_at:e.value.updated_at},null,8,["created_at","updated_at"])):_("",!0),n("div",T,[n("div",G,[a(z,{size:"96px",rounded:""},{default:i(()=>[n("img",{src:e.value.avatar},null,8,H)]),_:1})]),n("div",K,[a(y,{class:"",modelValue:e.value.name,"onUpdate:modelValue":s[0]||(s[0]=l=>e.value.name=l),label:"name zh",outlined:"",dense:"",clearable:"","lazy-rules":"",rules:[l=>l.length>0||"Please type something"],disable:""},null,8,["modelValue","rules"]),a(y,{class:"",outlined:"",modelValue:e.value.nickname,"onUpdate:modelValue":s[1]||(s[1]=l=>e.value.nickname=l),label:"nickname",hint:"",dense:"",clearable:"","lazy-rules":"",rules:[l=>l.length>0||"Please type something"],disable:""},null,8,["modelValue","rules"])])]),n("div",M,[a(y,{class:"col-6 q-pr-sm",outlined:"",modelValue:e.value.email,"onUpdate:modelValue":s[2]||(s[2]=l=>e.value.email=l),label:"email",hint:"",dense:"",clearable:"","lazy-rules":"",rules:[l=>l.length>=0||"Please type something"],disable:""},null,8,["modelValue","rules"]),a(y,{class:"col-6 q-pl-sm",outlined:"",modelValue:e.value.mobile,"onUpdate:modelValue":s[3]||(s[3]=l=>e.value.mobile=l),label:"mobile",hint:"",dense:"",clearable:"","lazy-rules":"",rules:[l=>l.length>=0||"Please type something"],disable:""},null,8,["modelValue","rules"])]),a(P,{class:"q-mt-lg",onSubmit:D,onReset:k},{default:i(()=>[n("div",W,[a(w,null,{default:i(()=>[a(v,{class:"q-mr-xs",avatar:""},{default:i(()=>[X]),_:1}),a(v,{class:""},{default:i(()=>[n("div",Z,[(r(!0),p(g,null,N(c.value,l=>(r(),q(A,{key:l.label,modelValue:l.isEnable,"onUpdate:modelValue":t=>l.isEnable=t,label:l.label,dense:""},null,8,["modelValue","onUpdate:modelValue","label"]))),128))])]),_:1})]),_:1})]),e.value.gender>=0?(r(),p("div",ee,[a(w,null,{default:i(()=>[a(v,{class:"q-mr-xs",avatar:""},{default:i(()=>[le]),_:1}),a(v,{class:""},{default:i(()=>[n("div",ae,[(r(),p(g,null,N(J,(l,t)=>a(O,{key:t,modelValue:e.value.gender,"onUpdate:modelValue":s[4]||(s[4]=m=>e.value.gender=m),val:t,label:l,dense:""},null,8,["modelValue","val","label"])),64))])]),_:1})]),_:1})])):_("",!0),e.value.status>=0?(r(),p("div",te,[a(w,null,{default:i(()=>[a(v,{class:"q-mr-xs",avatar:""},{default:i(()=>[se]),_:1}),a(v,{class:""},{default:i(()=>[n("div",oe,[(r(),p(g,null,N(x,(l,t)=>a(O,{key:t,modelValue:e.value.status,"onUpdate:modelValue":s[5]||(s[5]=m=>e.value.status=m),val:t,label:l,dense:""},null,8,["modelValue","val","label"])),64))])]),_:1})]),_:1})])):_("",!0),n("div",ne,[u.value=="Update"?(r(),p(g,{key:0},[a(h,{dense:"",outline:"",color:"negative",icon:"add",round:"",onClick:Q}),a(h,{dense:"",outline:"",color:"negative",icon:"remove",round:"",onClick:C})],64)):_("",!0),a(h,{class:"q-px-md",dense:"","no-caps":"",unelevated:"",label:"Reset",type:"reset",color:"primary",icon:"restart_alt",outline:"",rounded:""}),a(h,{class:"q-px-md",dense:"",outline:"","no-caps":"",unelevated:"",label:u.value,type:"submit",color:"primary",icon:"cloud_upload",rounded:""},null,8,["label"])])]),_:1})]),_:1}))}});export{Oe as default};
